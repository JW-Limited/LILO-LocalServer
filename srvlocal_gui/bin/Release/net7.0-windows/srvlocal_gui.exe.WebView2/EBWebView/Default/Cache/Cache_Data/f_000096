/* content-script - v2.0.4 - 3/1/2023 */
/* included @adguard/extended-css v2.0.51 */
(function(){var configuration={commonCss:null,specificCss:".ins_exp.vsp, .mapsTextAds, #bepfo.popup[style^=\"visibility: visible\"] { display: none!important; }\n.b_ad { display: block !important; position: absolute !important; top: -9999px !important; }\n.b_adPATitleBlock + div, #pole > .productAd[data-ad-carousel], .b_adPATitleBlock { display: none!important; }\nbody .pa_carousel_mlo { display: block !important; position: absolute !important; top: -9999px !important; }\n.productAd, .shop_page .br-poleoffcarousel, #advertising_box, .b_spa_adblock, a.sb_meta[href^=\"http:\/\/advertise.bingads.microsoft.com\"], .promotion-panel-inner, #b_content > div#pole > div[class=\"ra_car_block ra_pole\"] > div.ra_car_container, .b_adLastChild, [id$=\"adsMvCarousel\"], #b_content > main[aria-label] > #b_ims_bza_pole, .td-a-rec, #top_advertisement, .b_ad { display: none!important; }\nbody .pa_sb { display: block !important; position: absolute !important; top: -9999px !important; }\n.ad_sc { display: none!important; }\nbody .b_adLastChild { display: block !important; position: absolute !important; top: -9999px !important; }\n.ins_exp.tds { display: none!important; }\n",extendedCssRules:["#b_results > .b_algo:-abp-has(> .b_caption > .b_attribution:matches-css-before(content: \/url\\(data:image\/)) { display: none!important; }",".slide:-abp-has(> .tobitem > a > .rtb_ad_caritem_mvtr) { display: none!important; }","#b_results > li.b_algo:-abp-has(> .b_caption > p:matches-css-before(content: \/^(Ad|Ann\\.|Annonce|Anúncio|Anzeige|Reklama|Реклама|Reclamă|Publicidade)$\/)) { display: none!important; }",".insights > .insml > li > .ins_exp > div > ul > li > .ta_c > a[href*=\"\/aclick?ld=\"]:upward(1) { display: none!important; }",".b_restorableLink { remove: true; }",],script:"var AG_onLoad=function(func){if(document.readyState===\"complete\"||document.readyState===\"interactive\")func();else if(document.addEventListener)document.addEventListener(\"DOMContentLoaded\",func);else if(document.attachEvent)document.attachEvent(\"DOMContentLoaded\",func)};\nvar AG_removeElementById = function(id) { var element = document.getElementById(id); if (element && element.parentNode) { element.parentNode.removeChild(element); }};\nvar AG_removeElementBySelector = function(selector) { if (!document.querySelectorAll) { return; } var nodes = document.querySelectorAll(selector); if (nodes) { for (var i = 0; i < nodes.length; i++) { if (nodes[i] && nodes[i].parentNode) { nodes[i].parentNode.removeChild(nodes[i]); } } } };\nvar AG_each = function(selector, fn) { if (!document.querySelectorAll) return; var elements = document.querySelectorAll(selector); for (var i = 0; i < elements.length; i++) { fn(elements[i]); }; };\nvar AG_removeParent = function(el, fn) { while (el && el.parentNode) { if (fn(el)) { el.parentNode.removeChild(el); return; } el = el.parentNode; } };\nvar AG_removeCookie=function(a){var e=\/.\/;\/^\\\/.+\\\/$\/.test(a)?e=new RegExp(a.slice(1,-1)):\"\"!==a&&(e=new RegExp(a.replace(\/[.*+?^${}()|[\\]\\\\]\/g,\"\\\\$&\")));a=function(){for(var a=document.cookie.split(\";\"),g=a.length;g--;){cookieStr=a[g];var d=cookieStr.indexOf(\"=\");if(-1!==d&&(d=cookieStr.slice(0,d).trim(),e.test(d)))for(var h=document.location.hostname.split(\".\"),f=0;f<h.length-1;f++){var b=h.slice(f).join(\".\");if(b){var c=d+\"=\",k=\"; domain=\"+b;b=\"; domain=.\"+b;document.cookie=c+\"; expires=Thu, 01 Jan 1970 00:00:00 GMT\";document.cookie=c+k+\"; expires=Thu, 01 Jan 1970 00:00:00 GMT\";document.cookie=c+b+\"; expires=Thu, 01 Jan 1970 00:00:00 GMT\";document.cookie=c+\"; path=\/; expires=Thu, 01 Jan 1970 00:00:00 GMT\";document.cookie=c+k+\"; path=\/; expires=Thu, 01 Jan 1970 00:00:00 GMT\";document.cookie=c+b+\"; path=\/; expires=Thu, 01 Jan 1970 00:00:00 GMT\"}}}};a();window.addEventListener(\"beforeunload\",a)};\nvar AG_defineProperty=function(){var p,q=Object.defineProperty;if(\"function\"==typeof WeakMap)p=WeakMap;else{var r=0,t=function(){this.a=(r+=Math.random()).toString()};t.prototype.set=function(a,b){var d=a[this.a];d&&d[0]===a?d[1]=b:q(a,this.a,{value:[a,b],writable:!0});return this};t.prototype.get=function(a){var b;return(b=a[this.a])&&b[0]===a?b[1]:void 0};t.prototype.has=function(a){var b=a[this.a];return b?b[0]===a:!1};p=t}function u(a){this.b=a;this.h=Object.create(null)}function v(a,b,d,e){this.a=a;this.i=b;this.c=d;this.f=e}function w(){this.g=\/^([^\\\\\\.]|\\\\.)*?\\.\/;this.j=\/\\\\(.)\/g;this.a=new p}function x(a,b){var d=b.f;if(d&&!(\"beforeGet\"in d||\"beforeSet\"in d))return z(d);var e={get:function(){var c=b.f;c&&c.beforeGet&&c.beforeGet.call(this,b.a.b);a:if(c=b.g)c=A(c)?c.value:c.get?c.get.call(this):void 0;else{c=b.a.b;if(b.i in c&&(c=B(c),null!==c)){var d=C.call(c,b.i);c=d?d.call(this):c[b.i];break a}c=void 0}(this===b.a.b||D.call(b.a.b,this))&&E(a,c,b.c);return c},set:function(c){if(this===b.a.b||D.call(b.a.b,this)){b.f&&b.f.beforeSet&&(c=b.f.beforeSet.call(this,c,this));var d=b.g;d&&A(d)&&d.value===c?c=!0:(d=F(b,c,this),G(c)&&(c=H(a,c),I(a,c,b.c)),c=d)}else c=F(b,c,this);return c}};d&&J(d,e,K);return e}function I(a,b,d){for(var e in d.h){var c=d.h[e];if(b.h[e]){var h=a,g=b.h[e],k=c;!k.f||g.f||\"undefined\"===typeof g.a.b||g.g||(g.g=z(k.f));g.c&&k.c&&g.c!==k.c&&I(h,g.c,k.c)}else{g=h=void 0;k=a;var f=b,l=c.i,m=\"undefined\"!==typeof f.b,y=!1;m&&(g=L(f.b,l))&&!g.configurable&&(y=!0,h=f.b[l]);var n=y?H(k,h):new u(c.c.b);I(k,n,c.c);n=new v(f,l,n,c.f);f.h[l]=n;m&&(n.g=g,m=x(k,n),y?E(k,h,c.c):(q(f.b,l,m),g&&A(g)&&(M(m,g.value,f.b),E(k,g.value,c.c))))}}}function E(a,b,d){G(b)&&(b=H(a,b),I(a,b,d))}function F(a,b,d){var e=a.g;if(!e){e=B(a.a.b);if(null!==e&&(e=N.call(e,a.i)))return e.call(d,b);if(!O(a.a.b))return!1;a.g={value:b,configurable:!0,writable:!0,enumerable:!0};return!0}return M(e,b,d)}function H(a,b){var d=a.a.get(b);d||(d=new u(b),a.a.set(b,d));return d}function A(a){return\"undefined\"!==typeof a.writable}function J(a,b,d){for(var e=0,c=d.length;e<c;e++){var h=d[e];h in a&&(b[h]=a[h])}}function z(a){if(a){var b={};J(a,b,P);return b}}function M(a,b,d){if(A(a))return a.writable?(a.value=b,!0):!1;if(!a.set)return!1;a.set.call(d,b);return!0}var P=\"configurable enumerable value get set writable\".split(\" \"),K=P.slice(0,2),L=Object.getOwnPropertyDescriptor,O=Object.isExtensible,B=Object.getPrototypeOf,D=Object.prototype.isPrototypeOf,C=Object.prototype.__lookupGetter__||function(a){return(a=Q(this,a))&&a.get?a.get:void 0},N=Object.prototype.__lookupSetter__||function(a){return(a=Q(this,a))&&a.set?a.set:void 0};function Q(a,b){if(b in a){for(;!w.hasOwnProperty.call(a,b);)a=B(a);return L(a,b)}}function G(a){var b=typeof a;return\"function\"===b||\"object\"===b&&null!==a?!0:!1}var R;return function(a,b,d){R||(R=new w);var e=R;d=d||window;var c=new u;a+=\".\";var h=c||new u;for(var g=e.g,k=e.j,f,l,m;a;){f=g.exec(a);if(null===f)throw 1;f=f[0].length;l=a.slice(0,f-1).replace(k,\"$1\");a=a.slice(f);(f=h.h[l])?m=f.c:(m=new u,f=new v(h,l,m),h.h[l]=f);h=m}if(!f)throw 1;a=f;a.f=b;E(e,d,c)};}();\nvar AG_abortOnPropertyWrite=function(a,b){var c=Math.random().toString(36).substr(2,8);AG_defineProperty(a,{beforeSet:function(){b&&console.warn(\"AdGuard aborted property write: \"+a);throw new ReferenceError(c);}});var d=window.onerror;window.onerror=function(e){if(\"string\"===typeof e&&-1!==e.indexOf(c))return b&&console.warn(\"AdGuard has caught window.onerror: \"+a),!0;if(d instanceof Function)return d.apply(this,arguments)}};\nvar AG_abortOnPropertyRead=function(a,b){var c=Math.random().toString(36).substr(2,8);AG_defineProperty(a,{beforeGet:function(){b&&console.warn(\"AdGuard aborted property read: \"+a);throw new ReferenceError(c);}});var d=window.onerror;window.onerror=function(e){if(\"string\"===typeof e&&-1!==e.indexOf(c))return b&&console.warn(\"AdGuard has caught window.onerror: \"+a),!0;if(d instanceof Function)return d.apply(this,arguments)}};\nvar AG_abortInlineScript=function(g,b,c){var d=function(){if(\"currentScript\"in document)return document.currentScript;var a=document.getElementsByTagName(\"script\");return a[a.length-1]},e=Math.random().toString(36).substr(2,8),h=d();AG_defineProperty(b,{beforeGet:function(){var a=d();if(a instanceof HTMLScriptElement&&a!==h&&\"\"===a.src&&g.test(a.textContent))throw c&&console.warn(\"AdGuard aborted execution of an inline script\"),new ReferenceError(e);}});var f=window.onerror;window.onerror=function(a){if(\"string\"===typeof a&&-1!==a.indexOf(e))return c&&console.warn(\"AdGuard has caught window.onerror: \"+b),!0;if(f instanceof Function)return f.apply(this,arguments)}};\nvar AG_setConstant=function(e,a){if(\"undefined\"===a)a=void 0;else if(\"false\"===a)a=!1;else if(\"true\"===a)a=!0;else if(\"noopFunc\"===a)a=function(){};else if(\"trueFunc\"===a)a=function(){return!0};else if(\"falseFunc\"===a)a=function(){return!1};else if(\/^\\d+$\/.test(a)){if(a=parseFloat(a),isNaN(a)||32767<Math.abs(a))return}else return;var b=!1;AG_defineProperty(e,{get:function(){return a},set:function(c){if(b)var d=!0;else void 0!==c&&void 0!==a&&typeof c!==typeof a&&(b=!0),d=b;d&&(a=c)}})};\n(function preventSetInterval(source,args){function hit(source){if(!0===source.verbose){try{const log=console.log.bind(console),trace=console.trace.bind(console);let prefix=source.ruleText||\"\";if(source.domainName){const AG_SCRIPTLET_MARKER=\"#%#\/\/\",UBO_SCRIPTLET_MARKER=\"##+js\";let ruleStartIndex;source.ruleText.indexOf(AG_SCRIPTLET_MARKER)>-1?ruleStartIndex=source.ruleText.indexOf(AG_SCRIPTLET_MARKER):source.ruleText.indexOf(UBO_SCRIPTLET_MARKER)>-1&&(ruleStartIndex=source.ruleText.indexOf(UBO_SCRIPTLET_MARKER));const rulePart=source.ruleText.slice(ruleStartIndex);prefix=\"\".concat(source.domainName).concat(rulePart)}log(\"\".concat(prefix,\" trace start\")),trace&&trace(),log(\"\".concat(prefix,\" trace end\"))}catch(e){}\"function\"==typeof window.__debug&&window.__debug(source)}}function noopFunc(){}function startsWith(str,prefix){return!!str&&0===str.indexOf(prefix)}function nativeIsNaN(num){return(Number.isNaN||window.isNaN)(num)}const updatedArgs=args?[].concat(source).concat(args):[source];try{(function(source,matchCallback,matchDelay){const shouldLog=void 0===matchCallback&&void 0===matchDelay,setIntervalHandler={apply:function(target,thisArg,args){const callback=args[0],delay=args[1];let shouldPrevent=!1;return shouldLog?(hit(source),function(source,message){let forced=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const name=source.name,ruleText=source.ruleText,verbose=source.verbose;if(!forced&&!verbose)return;let messageStr=\"\".concat(name,\": \").concat(message);if(ruleText){const RULE_MARKER=\"#%#\/\/scriptlet\",markerIdx=ruleText.indexOf(RULE_MARKER);if(markerIdx>-1){const ruleWithoutDomains=ruleText.slice(markerIdx,ruleText.length);messageStr+=\"; cannot apply rule: \".concat(ruleWithoutDomains)}}console.log(messageStr)}(source,\"setInterval(\".concat(String(callback),\", \").concat(delay,\")\"),!0)):shouldPrevent=function(_ref){let callback=_ref.callback,delay=_ref.delay,matchCallback=_ref.matchCallback,matchDelay=_ref.matchDelay;if(!function(callback){return callback instanceof Function||\"string\"==typeof callback}(callback))return!1;if(!function(match){let str=match;return startsWith(match,\"!\")&&(str=match.slice(1)),function(input){const FORWARD_SLASH=\"\/\";let isValid,str=function(str){return str.replace(\/[.*+?^${}()|[\\]\\\\]\/g,\"\\\\$&\")}(input);input[0]===FORWARD_SLASH&&input[input.length-1]===FORWARD_SLASH&&(str=input.slice(1,-1));try{isValid=new RegExp(str),isValid=!0}catch(e){isValid=!1}return isValid}(str)}(matchCallback)||matchDelay&&!function(match){let str=match;startsWith(match,\"!\")&&(str=match.slice(1));const num=parseFloat(str);return!nativeIsNaN(num)&&function(num){return(Number.isFinite||window.isFinite)(num)}(num)}(matchDelay))return!1;const _parseMatchArg=function(match){const isInvertedMatch=startsWith(match,\"!\"),matchRegexp=function(){let input=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";const FORWARD_SLASH=\"\/\";if(\"\"===input)return new RegExp(\".?\");if(input[0]===FORWARD_SLASH&&input[input.length-1]===FORWARD_SLASH)return new RegExp(input.slice(1,-1));const escaped=input.replace(\/[.*+?^${}()|[\\]\\\\]\/g,\"\\\\$&\");return new RegExp(escaped)}(isInvertedMatch?match.slice(1):match);return{isInvertedMatch:isInvertedMatch,matchRegexp:matchRegexp}}(matchCallback),isInvertedMatch=_parseMatchArg.isInvertedMatch,matchRegexp=_parseMatchArg.matchRegexp,_parseDelayArg=function(delay){const isInvertedDelayMatch=startsWith(delay,\"!\");let delayValue=isInvertedDelayMatch?delay.slice(1):delay;delayValue=parseInt(delayValue,10);return{isInvertedDelayMatch:isInvertedDelayMatch,delayMatch:nativeIsNaN(delayValue)?null:delayValue}}(matchDelay),isInvertedDelayMatch=_parseDelayArg.isInvertedDelayMatch,delayMatch=_parseDelayArg.delayMatch,parsedDelay=function(delay){const parsedDelay=Math.floor(parseInt(delay,10));return\"number\"!=typeof parsedDelay||nativeIsNaN(parsedDelay)?delay:parsedDelay}(delay);let shouldPrevent=!1;const callbackStr=String(callback);return shouldPrevent=null===delayMatch?matchRegexp.test(callbackStr)!==isInvertedMatch:matchCallback?matchRegexp.test(callbackStr)!==isInvertedMatch&&parsedDelay===delayMatch!==isInvertedDelayMatch:parsedDelay===delayMatch!==isInvertedDelayMatch,shouldPrevent}({callback:callback,delay:delay,matchCallback:matchCallback,matchDelay:matchDelay}),shouldPrevent&&(hit(source),args[0]=noopFunc),target.apply(thisArg,args)}};window.setInterval=new Proxy(window.setInterval,setIntervalHandler)}).apply(this,updatedArgs)}catch(e){console.log(e)}})({name:\"prevent-setInterval\",engine:\"corelibs\",version:\"1.11.59\",verbose:false},[\"logQueue\",\"10000\",]);\n\/** stealth-script - v1.1.5 - 4\/20\/2022 *\/\n!function(){var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getPrototypeOf,n=Object.create,o=Object.getOwnPropertyNames,i=Object.prototype.toString,a=Object.prototype.hasOwnProperty,s=Function.prototype.apply,c=Function.prototype.call,u=Function.prototype.bind,p=window.Proxy,l=window.Reflect,f={};p&&(f.preventExtensions=l.preventExtensions,f.defineProperty=l.defineProperty,f.get=l.get,f.set=l.set,f.deleteProperty=l.deleteProperty,f.ownKeys=l.ownKeys,f.apply=l.apply);var h,d=window.MutationObserver||window.WebKitMutationObserver,v=t(HTMLIFrameElement.prototype,\"contentWindow\").get,y=t(HTMLIFrameElement.prototype,\"contentDocument\").get,g=Error.captureStackTrace,m=function(){};if(\"function\"==typeof WeakMap)h=WeakMap;else{var w=0;h=function(){function t(){this.$name=(w+=Math.random()).toString()}return t.prototype.set=function(t,r){var n=t[this.$name];return n&&n[0]===t?n[1]=r:e(t,this.$name,{value:[t,r],writable:!0}),this},t.prototype.get=function(e){var t;return(t=e[this.$name])&&t[0]===e?t[1]:void 0},t.prototype.delete=function(e){var t=e[this.$name];if(!t)return!1;var r=t[0]===e;return t[0]=t[1]=void 0,r},t.prototype.has=function(e){var t=e[this.$name];return!!t&&t[0]===e},t}()}var b=h;var P=p?f.apply:function(){var t;do{t=Math.random()}while(t in s);return e(s,t,{value:c}),function(e,r,n){return s[t](e,r,n)}}(),T=function(e){this.original=e};function A(e,t){return e instanceof T}var E=function(){function e(e,t,r){this.orig=e,this.thisArg=t,this.wrapper=r,this.originalInvoked=!1,this.invokeTarget=P(u,this.invokeTarget,[this])}return e.prototype.invokeTarget=function(e,t){void 0===t&&(t=this.thisArg),this.originalInvoked&&function(e,t){throw t}(0,1),this.originalInvoked=!0;try{return P(this.orig,t,e)}catch(e){throw g&&g(e,this.wrapper),new T(e)}},e}(),x=new b;function k(r,n,o){var i=t(r,o);i&&i.configurable&&(i.value=r[o],e(n,o,i))}var O=function(e,t){var r=e.thisArg,n=x.get(r);return void 0===n&&(n=r),e.invokeTarget(t,n)};function S(e,t){var r=function(){var n=new E(e,this,r);try{return t(n,arguments)}catch(e){if(!n.originalInvoked)try{return n.invokeTarget(arguments)}catch(t){e=t}if(A(e))throw e.original}};return C(e,r),r}function C(e,t){k(e,t,\"name\"),k(e,t,\"length\"),x.set(t,e)}function N(e,t,r){e.hasOwnProperty(t)&&(e[t]=S(e[t],r))}function D(r,n,o,i){var a=t(r,n);if(a&&a.get&&a.configurable){var s,c=S(a.get,o);a.set&&(s=S(a.set,i)),e(r,n,{get:c,set:s,configurable:!0,enumerable:a.enumerable})}}function M(e){var t=e.Function.prototype;N(t,\"toString\",O),N(t,\"toSource\",O)}var $=Object.freeze({__proto__:null,makeFunctionWrapper:S,makeSurrogate:C,wrapMethod:N,wrapAccessor:D,$apply:M});function I(e){return void 0===e}function F(e){return\"[object Navigator]\"===i.call(e)}function L(e){return\"id\"in e}var _=\"about:\",j=\"function\"==typeof URL?function(e){return new URL(e)}:function(e){var t=document.createElement(\"a\");return t.href=e,\"\"==t.host&&(t.href=t.href),t};var H=function(){function t(e,t,r){this.$window=e,this.globalKey=r,this.callbacks=[],this.onFrameLoad=u.call(this.onFrameLoad,this),this.processChildOnContentAccess=u.call(this.processChildOnContentAccess,this);var n=e.HTMLIFrameElement.prototype;this.frameToDocument=new b,t.wrapAccessor(n,\"contentWindow\",this.processChildOnContentAccess),t.wrapAccessor(n,\"contentDocument\",this.processChildOnContentAccess),this.observeChildFrames(e)}return t.prototype.observeChildFrames=function(e){var t=this;d&&(this.childFrameObserver||(this.childFrameObserver=new d((function(e){for(var r=0,n=e.length;r<n;r++)for(var o=e[r].addedNodes,i=0,a=o.length;i<a;i++){var s=o[i];if(\"IFRAME\"===s.nodeName)t.processChildFrameIfNew(s);else if(L(s))for(var c=s.getElementsByTagName(\"IFRAME\"),u=0,p=c.length;u<p;u++){var l=c[u];t.processChildFrameIfNew(l)}}}))),this.childFrameObserver.observe(e.document.documentElement,{childList:!0,subtree:!0}))},t.prototype.processChildFrameIfNew=function(e){if(I(this.frameToDocument.get(e))){e.addEventListener(\"load\",this.onFrameLoad);try{var r=v.call(e);if(r.location.protocol===_){e.outerHTML,this.frameToDocument.set(e,r.document),this.processChildWindow(r);var n=e.src;n&&this.globalKey&&(o=n,i=this.$window.location,a=this.$window.document.domain,\"javascript:\"===(s=j(o)).protocol||\"about:blank\"===s.href||\"data:\"!==s.protocol&&s.hostname===a&&s.port===i.port&&s.protocol===i.protocol)&&t.setNonEnumerableValue(r,this.globalKey,void 0)}}catch(t){this.frameToDocument.set(e,null)}var o,i,a,s}},t.prototype.processChildOnContentAccess=function(e,t){var r=e.thisArg;return this.processChildFrameIfNew(r),e.invokeTarget(t)},t.prototype.processChildWindow=function(e){for(var t=this.callbacks,r=0,n=t.length;r<n;r++)t[r](e)},t.prototype.onFrameLoad=function(e){var t=e.target;try{var r=y.call(t);r.location.protocol===_&&this.frameToDocument.get(t)!==r&&(this.frameToDocument.set(t,r),this.processChildWindow(r.defaultView))}catch(e){this.frameToDocument.set(t,null)}},t.setNonEnumerableValue=function(t,r,n){e(t,r,{value:n,configurable:!0})},t.prototype.registerCallback=function(e){this.callbacks.push(e)},t}(),W=null,K=true,R=false,B=true,U=false,G=false,V=null,J=\"bdff4201087e4ce5bbd1b7e6b53\",z=null,X=true,q=J.substring(16)+J.substring(0,16)||\"adgStRunId\",Q=function(e,t){return F(e.thisArg)?W:e.invokeTarget(t)},Y=function(e,t){return F(e.thisArg)?function(e){var t=e.indexOf(\"\/\");if(-1===t)return e;var r=e.substring(t+1);return-1!==e.toLowerCase().indexOf(\"firefox\")&&(r=r.replace(\/\\(([^;)]+)[^)]*\\).*\/,\"($1)\")),r}(W):e.invokeTarget(t)},Z=W?function(e){D(e.Navigator.prototype,\"userAgent\",Q),D(e.Navigator.prototype,\"appVersion\",Y)}:m,ee=\/^RTC\/,te=K?function(e){o(e).filter((function(e){return ee.test(e)})).forEach((function(t){var r=e[t];\"function\"==typeof r&&-1!==r.toString().indexOf(\"[native code]\")&&delete e[t]})),delete e.webkitRTCPeerConnection,delete e.mozRTCPeerConnection;var t=e.Navigator.prototype;delete t.getUserMedia,delete t.webkitGetUserMedia,delete t.mozGetUserMedia}:m,re=\"referrer\",ne=t(Document.prototype,re).get;var oe=function(e,t){return function(e){try{ne.call(e)}catch(e){if(\"TypeError\"===e.name)return!1}return!0}(e.thisArg)?V:e.invokeTarget(t)},ie=V?function(r){var n=r.Document.prototype;D(n,re,oe);var o=t(n,re);if(o&&o.get&&!o.configurable){var i=r.HTMLDocument,a=i?i.prototype:r.document;o.get=S(o.get,oe),e(a,re,o)}}:m,ae=function(){function e(e){var t=this;this.$window=e,this.nativePromise=this.$window.Promise,this.nativeDOMExceptionCtor=this.$window.DOMException,this.denyNotification=function(e,r){var n=r[0],o=t.nativePromise.resolve(\"denied\");return\"function\"==typeof n&&o.then((function(e){n(e)})),o},this.showPermissionAsDenied=function(e,t){return\"denied\"},this.denySubscription=function(e,r){return n=e.thisArg,\"[object PushManager]\"!==i.call(n)?e.invokeTarget(r):t.nativePromise.reject(new t.nativeDOMExceptionCtor(\"\",\"NotAllowedError\"));var n}}return e.prototype.wrap=function(){var e=this.$window;e.Notification&&(N(e.Notification,\"requestPermission\",this.denyNotification),D(e.Notification,\"permission\",this.showPermissionAsDenied)),e.PushManager&&N(e.PushManager.prototype,\"subscribe\",this.denySubscription)},e}(),se=R?function(e){new ae(e).wrap()}:m,ce=new b,ue=function(e,t){return ce.has(e.thisArg)?1:e.invokeTarget(t)},pe=function(e,t){return ce.has(e.thisArg)?\"User denied geolocation\":e.invokeTarget(t)};function le(r){if(r.PositionError)return r.PositionError.prototype;var o=n(r.Object.prototype);o.PERMISSION_DENIED=1,o.POSITION_UNAVAILABLE=2,o.TIMEOUT=3;var i=r.MediaError;if(i){var a,s=i.prototype,c=function(e){var r=t(s,e);return r&&r.get?(r.get=function(e){function t(){try{e.call(this,arguments)}catch(e){throw\"TypeError\"===e.name&&(e.message=e.message.replace(\"MediaError\",\"PositionError\"),g&&g(e,t)),e}}return C(e,t),t}(r.get),r):a||(a={get:function(){throw new TypeError},enumerable:!0,configurable:!0})};e(o,\"code\",c(\"code\")),e(o,\"message\",c(\"message\"))}return o}var fe=function(){function e(e){var t=this;this.$window=e,this.notifyPositionError=function(e,r){if(!t.isGeolocation(e.thisArg))return e.invokeTarget(r);var n=r[1];\"function\"==typeof n&&setTimeout(n,0,t.getPositionError())},this.watchProcessId=0,this.notifyPositionErrorOnWatch=function(e,r){if(!t.isGeolocation(e.thisArg))return e.invokeTarget(r);var n=r[1];return\"function\"==typeof n&&setTimeout(n,0,t.getPositionError()),t.watchProcessId++}}return e.prototype.getPositionError=function(){var e=n(this.positionErrorPType);return ce.set(e,void 0),e},e.prototype.isGeolocation=function(e){try{this.nativeClearWatch.call(e,0)}catch(e){if(\"TypeError\"===e.name)return!1}return!0},e.prototype.wrap=function(){var e=this.$window.navigator.geolocation;if(e){this.nativeClearWatch=e.clearWatch,this.positionErrorPType=function(e){var t=le(e);return D(t,\"code\",ue),D(t,\"message\",pe),t}(this.$window);var t=r(e);N(t,\"getCurrentPosition\",this.notifyPositionError),N(t,\"watchPosition\",this.notifyPositionErrorOnWatch)}},e}(),he=B?function(e){new fe(e).wrap()}:m;function de(e){return!(!U||-1===e.indexOf(\"Shockwave Flash\"))||!(!G||-1===e.indexOf(\"Java\"))}function ve(e){return de(e.name)}function ye(e){return de(e.enabledPlugin.name)}var ge=\"function\"==typeof p,me={writable:!0,enumerable:!0,configurable:!0},we=function(){function r(){}return r.featureDetection=function(n){var i={};me.value=i;try{e(n,1e9,me)}catch(e){\"TypeError\"===e.name&&(r.indexedPropertySetterThrows=!0)}if(n[1e9]===i&&(r.indexedPropertySetterSupport=!0),delete n[1e9],n.length>0){var a=t(n,0);if(a){var s=a.value;r.indexedPropertySetterSupport=a.writable;var c=Ae(s);r.namedPropertiesAreEnumerable=n.propertyIsEnumerable(c),r.namedPropertiesAreListedAsOwnKeys=-1!==o(n).indexOf(c)}}},r.indexedPropertySetterSupport=!1,r.indexedPropertySetterThrows=!1,r.namedPropertiesAreEnumerable=!0,r.namedPropertiesAreListedAsOwnKeys=!0,r}();we.featureDetection(navigator.plugins);var be=function(){function o(e,t,r){this.originalArray=e,this.getName=t,this.elemShouldBeFiltered=r,this.prepare()}return o.defineIndexedProperty=function(t,r,n){var i=o.indexedPropDesc;i.value=n,e(t,r,i)},o.defineNamedProperty=function(t,r,n){var i=o.namedPropDesc;i.value=n,e(t,r,i)},o.prototype.prepare=function(){for(var e=this.originalArray,t=n(r(this.originalArray)),i=this.indexedPropertyHost=p?n(null):t,a=this.namedPropertyHost=p?n(null):t,s=0,c=0,u=e.length;c<u;c++){var l=e[c];if(!this.elemShouldBeFiltered(l)){var f=s++;o.defineIndexedProperty(i,f,l),o.defineNamedProperty(a,this.getName(l),l)}}this.$length=s,this.wrappedObject=p?new p(t,this):t},o.prototype.$item=function(e){return this.indexedPropertyHost[e]||null},o.prototype.$namedItem=function(e){return this.namedPropertyHost[e]||null},o.prototype.refresh=function(){this.originalArray.refresh(),this.prepare()},o.prototype.preventExtensions=function(e){return!we.indexedPropertySetterThrows&&f.preventExtensions(e)},o.prototype.getOwnPropertyDescriptor=function(e,r){return a.call(e,r)?t(e,r):null!==Te(r)?t(this.indexedPropertyHost,r):a.call(this.namedPropertyHost,r)?t(this.namedPropertyHost,r):void 0},o.prototype.defineProperty=function(e,t,r){return null!==Te(t)?we.indexedPropertySetterSupport?(f.defineProperty(e,t,r),!0):!we.indexedPropertySetterThrows:f.defineProperty(e,t,r)},o.prototype.has=function(e,t){return t in e||t in this.indexedPropertyHost||t in this.namedPropertyHost},o.prototype.get=function(e,t,n){if(a.call(e,t))return f.get(e,t,n);if(null!==Te(t))return f.get(this.indexedPropertyHost,t,n);if(a.call(this.namedPropertyHost,t))return f.get(this.namedPropertyHost,t,n);var o=r(e);return null!==o?f.get(o,t,n):void 0},o.prototype.set=function(e,r,n,o){if((o=this.wrappedObject)&&(o=e),a.call(e,r))return f.set(e,r,n,o);if(e===o&&null!=Te(r)){if(!we.indexedPropertySetterSupport)return!we.indexedPropertySetterThrows;if(\"object\"!=typeof o||null===o)return!1;var i=t(o,r),s=void 0;if(I(i))(s=me).value=n;else{if(\"get\"in i||\"set\"in i)return!1;if(!1===i.writable)return!1;s={value:n}}return f.defineProperty(o,r,s)}return f.set(e,r,n,o)},o.prototype.deleteProperty=function(e,t){return a.call(e,t)?f.deleteProperty(e,t):null!==Te(t)||f.deleteProperty(e,t)},o.prototype.ownKeys=function(e){var t=f.ownKeys(this.indexedPropertyHost);we.namedPropertiesAreListedAsOwnKeys&&Array.prototype.push.apply(t,f.ownKeys(this.namedPropertyHost));for(var r=f.ownKeys(e),n=0,o=r.length;n<o;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t},o.indexedPropDesc={writable:we.indexedPropertySetterSupport,enumerable:!0,configurable:ge},o.namedPropDesc={writable:we.indexedPropertySetterSupport,enumerable:we.namedPropertiesAreEnumerable,configurable:ge},o}();if(ge&&g){var Pe=be.prototype;o(l).forEach((function(e){if(Pe.hasOwnProperty(e)){var t=Pe[e];Pe[e]=function(){try{return f.apply(t,this,arguments)}catch(t){throw g(t,Pe[e]),t}}}}))}function Te(e){if(\"string\"!=typeof e)return null;var t=Number(e);return(0|t)===t&&1\/t>0?t:null}function Ae(e){return e.name}function Ee(e){return e.type}var xe=new b,ke=new b,Oe=function(e,t){var r=e.invokeTarget(t);if(!F(e.thisArg))return r;var n=xe.get(r);return n||(n=new be(r,Ae,ve),xe.set(r,n),ke.set(n.wrappedObject,n)),n.wrappedObject},Se=function(e,t){var r=e.invokeTarget(t);if(!F(e.thisArg))return r;var n=xe.get(r);return n||(n=new be(r,Ee,ye),xe.set(r,n),ke.set(n.wrappedObject,n)),n.wrappedObject},Ce=function(e,t){var r=ke.get(e.thisArg);return r?r.$item(t[0]):e.invokeTarget(t)},Ne=function(e,t){var r=ke.get(e.thisArg);return r?r.$namedItem(t[0]):e.invokeTarget(t)},De=function(e,t){var r=ke.get(e.thisArg);return r?r.$length:e.invokeTarget(t)},Me=function(e,t){var r=ke.get(e.thisArg);return r?r.refresh():e.invokeTarget(t)},$e=U||G?function(e){var t=e.Navigator.prototype;D(t,\"plugins\",Oe),D(t,\"mimeTypes\",Se);var r=e.PluginArray;if(r){var n=r.prototype;N(n,\"item\",Ce),N(n,\"namedItem\",Ne),D(n,\"length\",De),N(n,\"refresh\",Me)}var o=e.MSPluginsCollection;o&&D(o.prototype,\"length\",De);var i=e.MimeTypeArray;if(i){var a=i.prototype;N(a,\"item\",Ce),N(a,\"namedItem\",Ne),D(a,\"length\",De)}var s=e.MSMimeTypesCollection;s&&D(s.prototype,\"length\",De)}:m,Ie=U?function(e){var t=e.ActiveXObject,r=!1;try{new t(\" \")}catch(e){-2146827859===e.number&&(r=!0)}if(r){var n=function(e,r){if(this instanceof n){\"string\"==typeof e&&0===e.indexOf(\"ShockwaveFlash.ShockwaveFlash\")&&(e=\" \");for(var o=[void 0],i=0,a=arguments.length;i<a;i++)o.push(arguments[i]);var s=u.apply(t,o);return new s}return t.apply(this,arguments)};n.prototype=t.prototype,n.prototype.constructor=n,C(t,n),e.ActiveXObject=n}}:m,Fe=function(e){return!e||\"\"===e.trim()},Le=\/^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$\/,_e=function(e){if(!e)throw new TypeError(\"empty cookie data\");if(!Le.test(e.name))throw new TypeError(\"Cookie name is invalid: \".concat(e.name));if(e.value&&!Le.test(e.value))throw new TypeError(\"Cookie value is invalid: \".concat(e.value));if(e.domain&&!Le.test(e.domain))throw new TypeError(\"Cookie domain is invalid: \".concat(e.domain));if(e.path&&!Le.test(e.path))throw new TypeError(\"Cookie path is invalid: \".concat(e.path));if(e.expires&&\"function\"!=typeof e.expires.toUTCString)throw new TypeError(\"Cookie expires is invalid: \".concat(e.expires));var t=\"\".concat(e.name,\"=\").concat(e.value);if(\"number\"!=typeof e.maxAge||isNaN(e.maxAge)||(t+=\"; Max-Age=\".concat(Math.floor(e.maxAge))),e.domain&&(t+=\"; Domain=\".concat(e.domain)),e.path&&(t+=\"; Path=\".concat(e.path)),e.expires&&(t+=\"; Expires=\".concat(e.expires.toUTCString())),e.httpOnly&&(t+=\"; HttpOnly\"),e.secure&&(t+=\"; Secure\"),!Fe(e.sameSite))switch(e.sameSite.toLowerCase()){case\"lax\":t+=\"; SameSite=Lax\";break;case\"strict\":t+=\"; SameSite=Strict\";break;default:throw new TypeError(\"Cookie sameSite is invalid: \".concat(e.sameSite))}return t},je=function(e,t){var r;if(null==t)return e;var n=function(e){if(Fe(e))return null;var t=e.split(\";\").filter((function(e){return!Fe(e)})),r=t.shift().split(\"=\"),n={name:r.shift(),value:r.join(\"=\")};return t.forEach((function(e){var t=e.split(\"=\"),r=t.shift().trim().toLowerCase(),o=t.join(\"=\");\"expires\"===r?n.expires=new Date(o):\"max-age\"===r?n.maxAge=parseInt(o,10):\"secure\"===r?n.secure=!0:\"httponly\"===r?n.httpOnly=!0:\"samesite\"===r?n.sameSite=o:n[r]=o})),n}(e);if(0===t)return n.expires=new Date,n.maxAge&&delete n.maxAge,_e(n);var o=Date.now();n.maxAge?r=o+1e3*n.maxAge:n.expires&&(r=n.expires.getTime());var i=o+60*t*1e3;return r<=i?e:(n.expires=new Date(i),n.maxAge&&delete n.maxAge,_e(n))},He=function(e,t){return e.invokeTarget(t)},We=function(e,t){if(!function(e){try{Be.call(e)}catch(e){if(\"TypeError\"===e.name)return!1}return!0}(e.thisArg))return e.invokeTarget(t);var r=t[0];return t[0]=je(r,z),e.invokeTarget(t)},Ke=\"cookie\",Re=function(){return t(window.Document.prototype,Ke)?window.Document.prototype:t(window.HTMLDocument.prototype,Ke)?window.HTMLDocument.prototype:void 0},Be=t(Re(),Ke).get;var Ue,Ge=void 0!==z?function(e){var t=Re();t&&D(t,Ke,He,We)}:m,Ve={childList:!0,subtree:!0};function Je(e){for(var t=e.attributes,r=0;r<t.length;r++)try{t[r].value.length>4&&t[r].value.indexOf(\".swf\")===t[r].value.length-4&&e.setAttribute(t[r].name,\" \")}catch(e){t[r].name,t[r].value}}var ze=U?function(e){if(!Ue){if(!d)return;Ue=new d((function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t].addedNodes;if(n)for(var o=0,i=n.length;o<i;o++){var a=n[o];if(L(a)){var s=a.nodeName;if(\"EMBED\"!==s&&\"OBJECT\"!==s||!a.hasAttributes()){var c=a.getElementsByTagName(\"EMBED\"),u=a.getElementsByTagName(\"OBJECT\"),p=void 0,l=void 0;for(p=0,l=c.length;p<l;p++)Je(c[p]);for(p=0,l=u.length;p<l;p++)Je(u[p])}else Je(a)}}}}))}Ue.observe(e.document.documentElement,Ve)}:m,Xe=function(e,t){return F(e.thisArg)?\"1\":e.invokeTarget(t)},qe=function(e,t){return!!F(e.thisArg)||e.invokeTarget(t)},Qe=X?function(t){var r=t.Navigator.prototype,n=\"doNotTrack\",o=\"globalPrivacyControl\";a.call(r,n)&&D(r,n,Xe),a.call(r,o)||e(r,o,{get:S(m,qe),configurable:!0})}:m;if(window.hasOwnProperty(q))delete window[q];else{var Ye=function(e){M(e);var t=new H(e,$,q);Z(e),te(e),ie(e),se(e),he(e),$e(e),Ie(e),Ge(),Qe(e),ze(e),t.registerCallback(Ye)};Ye(window)}}();\n\n",nonce:"bdff4201087e4ce5bbd1b7e6b53",filteringContext:{"isReferrerRuleJsInject":true,"isReferrerRuleElemhide":true},interceptionContext:{"isSubscriptionIntercept":true,"isUserscriptIntercept":true},safeBrowsingUrl:null,verbose:false},ElementUtils=function(){function e(){}return e.elementToString=function(e){var t=[];t.push("<"),t.push(e.localName);for(var r=e.attributes,o=0;o<r.length;o+=1){var s=r[o];t.push(" "),t.push(s.name),t.push('="');var n=null===s.value?"":s.value.replace(/"/g,'\\"');t.push(n),t.push('"')}return t.push(">"),t.join("")},e.appendChildren=function(e,t){var r=e.querySelectorAll("*");if(r&&r.length>0)for(var o=0;o<r.length;o+=1)t.push(r[o])},e.addUnique=function(e,t){if(t.length>0)for(var r=0;r<t.length;r+=1){var o=t[r];-1===e.indexOf(o)&&e.push(o)}},e.removeElements=function(e){for(var t=0;t<e.length;t+=1){e[t].remove()}},e.parseInfo=function(t,r){if(!t||t.indexOf(r)<0)return null;var o=decodeURIComponent(t),s=(o=(o=e.removeQuotes(o)).substring(r.length)).indexOf(";");if(s<0)return null;var n=parseInt(o.substring(0,s),10);return Number.isNaN(n)?null:{filterId:n,ruleText:o.substring(s+1)}},e.parseExtendedStyleInfo=function(t,r){var o=t.lastIndexOf("!important");if(-1===o)return e.parseInfo(t,r);var s=t.substring(0,o).trim();return e.parseInfo(s,r)},e.removeQuotes=function(e){return e.length>1&&('"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1])?e.substring(1,e.length-1):e},e}(),HitsStorage=function(){function e(){this.counter=0,this.randomKey=e.generateRandomKey(),this.map=new Map}return e.prototype.isCounted=function(e,t){var r=e[this.randomKey];if(r){var o=this.map.get(r);if(o)return o.element===e&&o.rule===t}return!1},e.prototype.setCounted=function(e,t){var r=this.getCounter();e[this.randomKey]=r,this.map.set(r,{element:e,rule:t})},e.prototype.getCounter=function(){return this.counter+=1,this.counter},e.generateRandomKey=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=0;r<10;r+=1)t+=e.charAt(Math.floor(Math.random()*e.length));return t},e}(),CssHitsCounter=function(){function e(e){this.hitsStorage=new HitsStorage,this.observer=null,this.countIsWorking=!1,this.onCssHitsFoundCallback=e,"complete"===document.readyState||"interactive"===document.readyState?this.countCssHits():document.addEventListener("readystatechange",this.startCounter.bind(this))}return e.prototype.stop=function(){this.onCssHitsFoundCallback=function(){},this.observer&&this.observer.disconnect()},e.prototype.countAffectedByExtendedCss=function(t){if(t&&t.rules&&t.rules.length>0){for(var r=[],o=0,s=t.rules;o<s.length;o++){var n=s[o];if(n.style&&n.style.content){var i=ElementUtils.parseExtendedStyleInfo(n.style.content,e.CONTENT_ATTR_PREFIX);if(null===i)continue;var l=i.filterId,a=i.ruleText;void 0!==l&&void 0!==a&&(r.push({filterId:l,ruleText:a,element:ElementUtils.elementToString(t.node)}),n.style.content="")}}this.onCssHitsFoundCallback(r)}return t},e.prototype.startCounter=function(){"interactive"!==document.readyState&&"complete"!==document.readyState||(this.countCssHits(),document.removeEventListener("readystatechange",this.startCounter))},e.prototype.countCssHits=function(){this.countAllCssHits(),this.countCssHitsForMutations()},e.prototype.countAllCssHits=function(){var t=this;if(!this.countIsWorking){this.countIsWorking=!0;var r=document.querySelectorAll("*");this.countCssHitsBatch(r,0,e.CSS_HITS_BATCH_SIZE,e.CSS_HITS_BATCH_SIZE,[],(function(e){e.length>0&&t.onCssHitsFoundCallback(e),t.countIsWorking=!1}))}},e.prototype.countCssHitsBatch=function(t,r,o,s,n,i){var l=this,a=Math.min(o,t.length);n=n.concat(this.countCssHitsForElements(t,r,a)),a!==t.length?(r=o,o+=s,window.setTimeout((function(){l.countCssHitsBatch(t,r,o,s,n,i)}),e.COUNT_CSS_HITS_BATCH_DELAY)):i(n)},e.prototype.countCssHitsForElements=function(t,r,o){r=r||0,o=o||t.length;for(var s=[],n=r;n<o;n+=1){var i=t[n],l=e.getCssHitData(i);if(l){var a=l.filterId,E=l.ruleText,c=a+";"+E;this.hitsStorage.isCounted(i,c)||(this.hitsStorage.setCounted(i,c),s.push({filterId:a,ruleText:E,element:ElementUtils.elementToString(i)}))}}return s},e.prototype.countCssHitsForMutations=function(){var t=this,r=window.MutationObserver;if(r){this.observer&&this.observer.disconnect();var o=new WeakSet,s=null;this.observer=new r((function(r){var n=[],i=[],l=[];(r.forEach((function(r){if(0!==r.addedNodes.length)for(var s=0;s<r.addedNodes.length;s+=1){var a=r.addedNodes[s];if(a instanceof Element&&!e.isIgnoredNodeTag(a.tagName)){var E=r.target;if(!a.parentNode&&E){if(o.has(a))return;n.push(a),o.add(a),ElementUtils.appendChildren(a,i),t.observer&&t.observer.disconnect(),r.target.appendChild(a)}else a.parentNode&&E&&(l.push(a),ElementUtils.appendChildren(a,l))}}})),l.length>0&&l.length<=e.CSS_HITS_BATCH_SIZE)&&((a=t.countCssHitsForElements(l,0,null)).length>0&&t.onCssHitsFoundCallback(a));var a,E=[];(ElementUtils.addUnique(E,i),ElementUtils.addUnique(E,n),E.length>0)&&((a=t.countCssHitsForElements(E,0,null)).length>0&&t.onCssHitsFoundCallback(a),ElementUtils.removeElements(n),t.startObserver());s&&window.clearTimeout(s),s=window.setTimeout((function(){t.countAllCssHits(),window.clearTimeout(s)}),e.COUNT_ALL_CSS_HITS_TIMEOUT_MS)})),this.startObserver()}},e.prototype.startObserver=function(){this.observer&&this.observer.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0})},e.getCssHitData=function(t){var r=getComputedStyle(t);return ElementUtils.parseInfo(r.content,e.CONTENT_ATTR_PREFIX)},e.isIgnoredNodeTag=function(e){return["script"].includes(e.toLowerCase())},e.COUNT_CSS_HITS_BATCH_DELAY=5,e.CSS_HITS_BATCH_SIZE=25,e.CONTENT_ATTR_PREFIX="adguard",e.COUNT_ALL_CSS_HITS_TIMEOUT_MS=500,e}(),logError=function(e){"undefined"!=typeof console&&console.error&&(console.error("Error in AdGuard script"),console.error(e))},logDebug=function(){if(configuration.verbose&&"undefined"!=typeof console&&console.error){for(var e,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];(e=console).debug.apply(e,["[AdGuard content-script]"].concat(r))}};function getCurrentScript(){var e=document.currentScript;if(!e){var t=document.getElementsByTagName("script");e=t[t.length-1]}return e}var currentScript=getCurrentScript(),rootElement=currentScript.parentNode,MO=window.MutationObserver||window.WebKitMutationObserver,ua=navigator.userAgent;-1!==ua.indexOf("MSIE")||ua.indexOf("Trident/");var createPolicy=function createPolicy(){var defaultPolicy={createHTML:function(e){return e},createScript:function(e){return e},createScriptURL:function(e){return e}},isTrustedScriptSupported=function(){try{return!eval(window.trustedTypes.emptyScript)}catch(e){return!1}}();return isTrustedScriptSupported?window.trustedTypes.createPolicy("AGPolicy",defaultPolicy):defaultPolicy},AGPolicy=createPolicy(),NONCE_ATTR_NAME="nonce",TYPE_ATTR_NAME="type",TYPE_ATTR_VALUE="text/css";function protectElementFromRemoval(e){if(MO){var t=e.parentElement,r={childList:!0},o=new MO((function(s){for(var n=0;n<s.length;n++)for(var i=s[n].removedNodes,l=0;l<i.length;l++){if(i[l]===e)return o.disconnect(),t.appendChild(e),void o.observe(t,r)}}));o.observe(t,r)}}function protectChild(e,t){if(MO){var r={childList:!0},o=new MO((function(){o.disconnect(),e.innerHTML="",e.appendChild(t),o.observe(e,r)}));o.observe(e,r)}}function protectTextNodeContent(e){if(MO){var t={characterData:!0,characterDataOldValue:!0},r=new MO((function(o){var s=o[0].oldValue;r.disconnect(),e.nodeValue=s,r.observe(e,t)}));r.observe(e,t)}}function protectElementAttributes(e,t){if(MO){var r=0,o={attributes:!0},s=new MO((function(n){for(var i=0;i<n.length;i++){if(n[i].type)return s.disconnect(),e.setAttribute(TYPE_ATTR_NAME,TYPE_ATTR_VALUE),e.setAttribute(NONCE_ATTR_NAME,t),void((r+=1)<50&&s.observe(e,o))}}));s.observe(e,o)}}var protectStyleElement=function(e,t,r){protectElementAttributes(e,r),protectElementFromRemoval(e),protectChild(e,t),protectTextNodeContent(t)};function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const NODE={SELECTOR_LIST:"SelectorList",SELECTOR:"Selector",REGULAR_SELECTOR:"RegularSelector",EXTENDED_SELECTOR:"ExtendedSelector",ABSOLUTE_PSEUDO_CLASS:"AbsolutePseudoClass",RELATIVE_PSEUDO_CLASS:"RelativePseudoClass"};class AnySelectorNode{constructor(e){_defineProperty(this,"children",[]),this.type=e}addChild(e){this.children.push(e)}}class RegularSelectorNode extends AnySelectorNode{constructor(e){super(NODE.REGULAR_SELECTOR),this.value=e}}class RelativePseudoClassNode extends AnySelectorNode{constructor(e){super(NODE.RELATIVE_PSEUDO_CLASS),this.name=e}}class AbsolutePseudoClassNode extends AnySelectorNode{constructor(e){super(NODE.ABSOLUTE_PSEUDO_CLASS),_defineProperty(this,"value",""),this.name=e}}const LEFT_SQUARE_BRACKET="[",RIGHT_SQUARE_BRACKET="]",LEFT_PARENTHESIS="(",RIGHT_PARENTHESIS=")",LEFT_CURLY_BRACKET="{",RIGHT_CURLY_BRACKET="}",BRACKET={SQUARE:{LEFT:LEFT_SQUARE_BRACKET,RIGHT:RIGHT_SQUARE_BRACKET},PARENTHESES:{LEFT:LEFT_PARENTHESIS,RIGHT:RIGHT_PARENTHESIS},CURLY:{LEFT:LEFT_CURLY_BRACKET,RIGHT:RIGHT_CURLY_BRACKET}},SLASH="/",BACKSLASH="\\",SPACE=" ",COMMA=",",DOT=".",SEMICOLON=";",COLON=":",SINGLE_QUOTE="'",DOUBLE_QUOTE='"',CARET="^",DOLLAR_SIGN="$",EQUAL_SIGN="=",TAB="\t",CARRIAGE_RETURN="\r",LINE_FEED="\n",FORM_FEED="\f",WHITE_SPACE_CHARACTERS=[SPACE,TAB,CARRIAGE_RETURN,LINE_FEED,FORM_FEED],ASTERISK="*",ID_MARKER="#",CLASS_MARKER=DOT,DESCENDANT_COMBINATOR=SPACE,CHILD_COMBINATOR=">",NEXT_SIBLING_COMBINATOR="+",SUBSEQUENT_SIBLING_COMBINATOR="~",COMBINATORS=[DESCENDANT_COMBINATOR,CHILD_COMBINATOR,NEXT_SIBLING_COMBINATOR,SUBSEQUENT_SIBLING_COMBINATOR],SUPPORTED_SELECTOR_MARKS=[LEFT_SQUARE_BRACKET,RIGHT_SQUARE_BRACKET,LEFT_PARENTHESIS,RIGHT_PARENTHESIS,LEFT_CURLY_BRACKET,RIGHT_CURLY_BRACKET,SLASH,BACKSLASH,SEMICOLON,COLON,COMMA,SINGLE_QUOTE,DOUBLE_QUOTE,CARET,DOLLAR_SIGN,ASTERISK,ID_MARKER,CLASS_MARKER,DESCENDANT_COMBINATOR,CHILD_COMBINATOR,NEXT_SIBLING_COMBINATOR,SUBSEQUENT_SIBLING_COMBINATOR,TAB,CARRIAGE_RETURN,LINE_FEED,FORM_FEED],SUPPORTED_STYLE_DECLARATION_MARKS=[COLON,SEMICOLON,SINGLE_QUOTE,DOUBLE_QUOTE,BACKSLASH,SPACE,TAB,CARRIAGE_RETURN,LINE_FEED,FORM_FEED],CONTAINS_PSEUDO="contains",HAS_TEXT_PSEUDO="has-text",ABP_CONTAINS_PSEUDO="-abp-contains",MATCHES_CSS_PSEUDO="matches-css",MATCHES_CSS_BEFORE_PSEUDO="matches-css-before",MATCHES_CSS_AFTER_PSEUDO="matches-css-after",MATCHES_ATTR_PSEUDO_CLASS_MARKER="matches-attr",MATCHES_PROPERTY_PSEUDO_CLASS_MARKER="matches-property",XPATH_PSEUDO_CLASS_MARKER="xpath",NTH_ANCESTOR_PSEUDO_CLASS_MARKER="nth-ancestor",CONTAINS_PSEUDO_NAMES=[CONTAINS_PSEUDO,HAS_TEXT_PSEUDO,ABP_CONTAINS_PSEUDO],UPWARD_PSEUDO_CLASS_MARKER="upward",REMOVE_PSEUDO_MARKER="remove",HAS_PSEUDO_CLASS_MARKER="has",ABP_HAS_PSEUDO_CLASS_MARKER="-abp-has",HAS_PSEUDO_CLASS_MARKERS=[HAS_PSEUDO_CLASS_MARKER,ABP_HAS_PSEUDO_CLASS_MARKER],IS_PSEUDO_CLASS_MARKER="is",NOT_PSEUDO_CLASS_MARKER="not",ABSOLUTE_PSEUDO_CLASSES=[CONTAINS_PSEUDO,HAS_TEXT_PSEUDO,ABP_CONTAINS_PSEUDO,MATCHES_CSS_PSEUDO,MATCHES_CSS_BEFORE_PSEUDO,MATCHES_CSS_AFTER_PSEUDO,MATCHES_ATTR_PSEUDO_CLASS_MARKER,MATCHES_PROPERTY_PSEUDO_CLASS_MARKER,XPATH_PSEUDO_CLASS_MARKER,NTH_ANCESTOR_PSEUDO_CLASS_MARKER,UPWARD_PSEUDO_CLASS_MARKER],RELATIVE_PSEUDO_CLASSES=[...HAS_PSEUDO_CLASS_MARKERS,IS_PSEUDO_CLASS_MARKER,NOT_PSEUDO_CLASS_MARKER],SUPPORTED_PSEUDO_CLASSES=[...ABSOLUTE_PSEUDO_CLASSES,...RELATIVE_PSEUDO_CLASSES],OPTIMIZATION_PSEUDO_CLASSES=[NOT_PSEUDO_CLASS_MARKER,IS_PSEUDO_CLASS_MARKER],SCOPE_CSS_PSEUDO_CLASS=":scope",REGULAR_PSEUDO_ELEMENTS={AFTER:"after",BACKDROP:"backdrop",BEFORE:"before",CUE:"cue",CUE_REGION:"cue-region",FIRST_LETTER:"first-letter",FIRST_LINE:"first-line",FILE_SELECTION_BUTTON:"file-selector-button",GRAMMAR_ERROR:"grammar-error",MARKER:"marker",PART:"part",PLACEHOLDER:"placeholder",SELECTION:"selection",SLOTTED:"slotted",SPELLING_ERROR:"spelling-error",TARGET_TEXT:"target-text"},AT_RULE_MARKER="@",CONTENT_CSS_PROPERTY="content",PSEUDO_PROPERTY_POSITIVE_VALUE="true",DEBUG_PSEUDO_PROPERTY_GLOBAL_VALUE="global",NO_SELECTOR_ERROR_PREFIX="Selector should be defined",STYLE_ERROR_PREFIX={NO_STYLE:"No style declaration found",NO_SELECTOR:`${NO_SELECTOR_ERROR_PREFIX} before style declaration in stylesheet`,INVALID_STYLE:"Invalid style declaration",UNCLOSED_STYLE:"Unclosed style declaration",NO_PROPERTY:"Missing style property in declaration",NO_VALUE:"Missing style value in declaration",NO_STYLE_OR_REMOVE:"Style should be declared or :remove() pseudo-class should used",NO_COMMENT:"Comments are not supported"},NO_AT_RULE_ERROR_PREFIX="At-rules are not supported",REMOVE_ERROR_PREFIX={INVALID_REMOVE:"Invalid :remove() pseudo-class in selector",NO_TARGET_SELECTOR:`${NO_SELECTOR_ERROR_PREFIX} before :remove() pseudo-class`,MULTIPLE_USAGE:"Pseudo-class :remove() appears more than once in selector",INVALID_POSITION:"Pseudo-class :remove() should be at the end of selector"},MATCHING_ELEMENT_ERROR_PREFIX="Error while matching element",MAX_STYLE_PROTECTION_COUNT=50,REGEXP_VALID_OLD_SYNTAX=/\[-(?:ext)-([a-z-_]+)=(["'])((?:(?=(\\?))\4.)*?)\2\]/g,INVALID_OLD_SYNTAX_MARKER="[-ext-",evaluateMatch=(e,t,r,o)=>{const s=new RegExp(`([^\\\\]|^)\\\\${r}`,"g");return`:${t}(${o.replace(s,`$1${r}`)})`},SCOPE_MARKER_REGEXP=/\(:scope >/g,SCOPE_REPLACER="(>",MATCHES_CSS_PSEUDO_ELEMENT_REGEXP=/(:matches-css)-(before|after)\(/g,convertMatchesCss=(e,t,r)=>`${t}${BRACKET.PARENTHESES.LEFT}${r}${COMMA}`,normalize=e=>{const t=e.replace(REGEXP_VALID_OLD_SYNTAX,evaluateMatch).replace(SCOPE_MARKER_REGEXP,SCOPE_REPLACER).replace(MATCHES_CSS_PSEUDO_ELEMENT_REGEXP,convertMatchesCss);if(t.includes(INVALID_OLD_SYNTAX_MARKER))throw new Error(`Invalid extended-css old syntax selector: '${e}'`);return t},convert=e=>{const t=e.trim();return normalize(t)},TOKEN_TYPE={MARK:"mark",WORD:"word"},tokenize=(e,t)=>{let r="";const o=[];return e.split("").forEach((e=>{if(t.includes(e))return r.length>0&&(o.push({type:TOKEN_TYPE.WORD,value:r}),r=""),void o.push({type:TOKEN_TYPE.MARK,value:e});r+=e})),r.length>0&&o.push({type:TOKEN_TYPE.WORD,value:r}),o},tokenizeSelector=e=>{const t=convert(e);return tokenize(t,SUPPORTED_SELECTOR_MARKS)},tokenizeAttribute=e=>tokenize(e,[...SUPPORTED_SELECTOR_MARKS,EQUAL_SIGN]),flatten=e=>{const t=[];e.forEach((e=>t.push(e)));const r=[];for(;t.length;){const e=t.pop();if(!e)throw new Error("Unable to make array flat");Array.isArray(e)?e.forEach((e=>t.push(e))):r.push(e)}return r.reverse()},getFirst=e=>e[0],getLast=e=>e[e.length-1],getPrevToLast=e=>e[e.length-2],getItemByIndex=(e,t,r)=>{const o=e[t];if(!o)throw new Error(r||`No array item found by index ${t}`);return o},NO_REGULAR_SELECTOR_ERROR="At least one of Selector node children should be RegularSelector",isSelectorListNode=e=>(null==e?void 0:e.type)===NODE.SELECTOR_LIST,isSelectorNode=e=>(null==e?void 0:e.type)===NODE.SELECTOR,isRegularSelectorNode=e=>(null==e?void 0:e.type)===NODE.REGULAR_SELECTOR,isExtendedSelectorNode=e=>e.type===NODE.EXTENDED_SELECTOR,isAbsolutePseudoClassNode=e=>(null==e?void 0:e.type)===NODE.ABSOLUTE_PSEUDO_CLASS,isRelativePseudoClassNode=e=>(null==e?void 0:e.type)===NODE.RELATIVE_PSEUDO_CLASS,getNodeName=e=>{if(null===e)throw new Error("Ast node should be defined");if(!isAbsolutePseudoClassNode(e)&&!isRelativePseudoClassNode(e))throw new Error("Only AbsolutePseudoClass or RelativePseudoClass ast node can have a name");if(!e.name)throw new Error("Extended pseudo-class should have a name");return e.name},getNodeValue=(e,t)=>{if(null===e)throw new Error("Ast node should be defined");if(!isRegularSelectorNode(e)&&!isAbsolutePseudoClassNode(e))throw new Error("Only RegularSelector ot AbsolutePseudoClass ast node can have a value");if(!e.value)throw new Error(t||"Ast RegularSelector ot AbsolutePseudoClass node should have a value");return e.value},getRegularSelectorNodes=e=>e.filter(isRegularSelectorNode),getFirstRegularChild=(e,t)=>{const r=getRegularSelectorNodes(e),o=getFirst(r);if(!o)throw new Error(t||NO_REGULAR_SELECTOR_ERROR);return o},getLastRegularChild=e=>{const t=getRegularSelectorNodes(e),r=getLast(t);if(!r)throw new Error(NO_REGULAR_SELECTOR_ERROR);return r},getNodeOnlyChild=(e,t)=>{if(1!==e.children.length)throw new Error(t);const r=getFirst(e.children);if(!r)throw new Error(t);return r},getPseudoClassNode=e=>getNodeOnlyChild(e,"Extended selector should be specified"),getRelativeSelectorListNode=e=>{if(!isRelativePseudoClassNode(e))throw new Error("Only RelativePseudoClass node can have relative SelectorList node as child");return getNodeOnlyChild(e,`Missing arg for :${getNodeName(e)}() pseudo-class`)},ATTRIBUTE_CASE_INSENSITIVE_FLAG="i",POSSIBLE_MARKS_BEFORE_REGEXP={COMMON:[BRACKET.PARENTHESES.LEFT,SINGLE_QUOTE,DOUBLE_QUOTE,EQUAL_SIGN,DOT,COLON,SPACE],CONTAINS:[BRACKET.PARENTHESES.LEFT,SINGLE_QUOTE,DOUBLE_QUOTE]},isSupportedPseudoClass=e=>SUPPORTED_PSEUDO_CLASSES.includes(e),isOptimizationPseudoClass=e=>OPTIMIZATION_PSEUDO_CLASSES.includes(e),doesRegularContinueAfterSpace=(e,t)=>!(!e||!t)&&(COMBINATORS.includes(t)||e===TOKEN_TYPE.WORD||t===ASTERISK||t===ID_MARKER||t===CLASS_MARKER||t===COLON||t===SINGLE_QUOTE||t===DOUBLE_QUOTE||t===BRACKET.SQUARE.LEFT),isRegexpOpening=(e,t,r)=>{const o=getLast(e.extendedPseudoNamesStack);if(!o)throw new Error("Regexp pattern allowed only in arg of extended pseudo-class");if(CONTAINS_PSEUDO_NAMES.includes(o))return POSSIBLE_MARKS_BEFORE_REGEXP.CONTAINS.includes(t);if(t===SLASH&&o!==XPATH_PSEUDO_CLASS_MARKER){throw new Error(`Invalid regexp pattern for :${o}() pseudo-class ${r?`in arg part: '${r}'`:"arg"}`)}return POSSIBLE_MARKS_BEFORE_REGEXP.COMMON.includes(t)},isAttributeOpening=(e,t)=>e===BRACKET.SQUARE.LEFT&&t!==BACKSLASH,isAttributeClosing=e=>{var t;if(!e.isAttributeBracketsOpen)return!1;const r=e.attributeBuffer.split(SPACE).join(""),o=tokenizeAttribute(r),s=getFirst(o),n=null==s?void 0:s.type,i=null==s?void 0:s.value;if(n===TOKEN_TYPE.MARK&&i!==BACKSLASH)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '${i}' at start of it`);const l=getLast(o),a=null==l?void 0:l.type,E=null==l?void 0:l.value;if(E===EQUAL_SIGN)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '${EQUAL_SIGN}'`);const c=o.findIndex((e=>e.type===TOKEN_TYPE.MARK&&e.value===EQUAL_SIGN)),u=null===(t=getPrevToLast(o))||void 0===t?void 0:t.value;if(-1===c)return a===TOKEN_TYPE.WORD||u===BACKSLASH&&(E===DOUBLE_QUOTE||E===SINGLE_QUOTE);const d=getItemByIndex(o,c+1).value;if(!(d===SINGLE_QUOTE||d===DOUBLE_QUOTE)){if(a===TOKEN_TYPE.WORD)return!0;throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute`)}return a===TOKEN_TYPE.WORD&&(null==E?void 0:E.toLocaleLowerCase())===ATTRIBUTE_CASE_INSENSITIVE_FLAG?u===d:E===d},isWhiteSpaceChar=e=>!!e&&WHITE_SPACE_CHARACTERS.includes(e),isAbsolutePseudoClass=e=>ABSOLUTE_PSEUDO_CLASSES.includes(e),isRelativePseudoClass=e=>RELATIVE_PSEUDO_CLASSES.includes(e),getBufferNode=e=>0===e.pathToBufferNode.length?null:getLast(e.pathToBufferNode)||null,getBufferNodeParent=e=>e.pathToBufferNode.length<2?null:getPrevToLast(e.pathToBufferNode)||null,getContextLastRegularSelectorNode=e=>{const t=getBufferNode(e);if(!t)throw new Error("No bufferNode found");if(!isSelectorNode(t))throw new Error("Unsupported bufferNode type");const r=getLastRegularChild(t.children);return e.pathToBufferNode.push(r),r},updateBufferNode=(e,t)=>{const r=getBufferNode(e);if(null===r)throw new Error("No bufferNode to update");if(isAbsolutePseudoClassNode(r))r.value+=t;else{if(!isRegularSelectorNode(r))throw new Error(`${r.type} node cannot be updated. Only RegularSelector and AbsolutePseudoClass are supported`);r.value+=t,e.isAttributeBracketsOpen&&(e.attributeBuffer+=t)}},addSelectorListNode=e=>{const t=new AnySelectorNode(NODE.SELECTOR_LIST);e.ast=t,e.pathToBufferNode.push(t)},addAstNodeByType=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const o=getBufferNode(e);if(null===o)throw new Error("No buffer node");let s;s=t===NODE.REGULAR_SELECTOR?new RegularSelectorNode(r):t===NODE.ABSOLUTE_PSEUDO_CLASS?new AbsolutePseudoClassNode(r):t===NODE.RELATIVE_PSEUDO_CLASS?new RelativePseudoClassNode(r):new AnySelectorNode(t),o.addChild(s),e.pathToBufferNode.push(s)},initAst=(e,t)=>{addSelectorListNode(e),addAstNodeByType(e,NODE.SELECTOR),addAstNodeByType(e,NODE.REGULAR_SELECTOR,t)},initRelativeSubtree=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";addAstNodeByType(e,NODE.SELECTOR_LIST),addAstNodeByType(e,NODE.SELECTOR),addAstNodeByType(e,NODE.REGULAR_SELECTOR,t)},upToClosest=(e,t)=>{for(let o=e.pathToBufferNode.length-1;o>=0;o-=1){var r;if((null===(r=e.pathToBufferNode[o])||void 0===r?void 0:r.type)===t){e.pathToBufferNode=e.pathToBufferNode.slice(0,o+1);break}}},getUpdatedBufferNode=e=>{const t=getBufferNode(e);if(t&&isSelectorListNode(t)&&isRelativePseudoClassNode(getBufferNodeParent(e)))return t;upToClosest(e,NODE.SELECTOR);const r=getBufferNode(e);if(!r)throw new Error("No SelectorNode, impossible to continue selector parsing by ExtendedCss");const o=getLast(r.children),s=o&&isExtendedSelectorNode(o)&&0===e.standardPseudoBracketsStack.length,n=s&&getFirst(o.children);let i=r;if(n){const t=s&&n.name,r=t&&isRelativePseudoClass(t),l=t&&isAbsolutePseudoClass(t),a=r&&e.extendedPseudoBracketsStack.length>0&&e.extendedPseudoBracketsStack.length===e.extendedPseudoNamesStack.length,E=l&&t===getLast(e.extendedPseudoNamesStack);(a||E)&&(e.pathToBufferNode.push(o),i=n)}else i=s?r:getContextLastRegularSelectorNode(e);return e.pathToBufferNode.push(i),i},handleNextTokenOnColon=(e,t,r,o,s)=>{if(!o)throw new Error(`Invalid colon ':' at the end of selector: '${t}'`);if(isSupportedPseudoClass(o.toLowerCase())){if(HAS_PSEUDO_CLASS_MARKERS.includes(o)&&e.standardPseudoNamesStack.length>0)throw new Error(`Usage of :${o}() pseudo-class is not allowed inside regular pseudo: '${getLast(e.standardPseudoNamesStack)}'`);upToClosest(e,NODE.SELECTOR),addAstNodeByType(e,NODE.EXTENDED_SELECTOR)}else{if(o.toLowerCase()===REMOVE_PSEUDO_MARKER)throw new Error(`${REMOVE_ERROR_PREFIX.INVALID_REMOVE}: '${t}'`);updateBufferNode(e,r),s&&s===BRACKET.PARENTHESES.LEFT&&!e.isAttributeBracketsOpen&&e.standardPseudoNamesStack.push(o)}},IS_OR_NOT_PSEUDO_SELECTING_ROOT=`html ${ASTERISK}`,hasExtendedSelector=e=>e.children.some((e=>e.children.some((e=>isExtendedSelectorNode(e))))),selectorListOfRegularsToString=e=>e.children.map((e=>{const t=getNodeOnlyChild(e,"Ast Selector node should have RegularSelector node");return getNodeValue(t)})).join(`${COMMA}${SPACE}`),updateNodeChildren=(e,t)=>(e.children=t,e),shouldOptimizeExtendedSelector=e=>{if(null===e)return!1;const t=getPseudoClassNode(e),r=getNodeName(t);if(isAbsolutePseudoClass(r))return!1;const o=getRelativeSelectorListNode(t).children;if(isOptimizationPseudoClass(r)){if(o.every((e=>{try{const t=getNodeOnlyChild(e,"Selector node should have RegularSelector");return isRegularSelectorNode(t)}catch(e){return!1}})))return!0}return o.some((e=>e.children.some((e=>!!isExtendedSelectorNode(e)&&shouldOptimizeExtendedSelector(e)))))},getOptimizedExtendedSelector=(e,t)=>{if(!e)return null;const r=getPseudoClassNode(e),o=getRelativeSelectorListNode(r);if(!hasExtendedSelector(o)){const e=selectorListOfRegularsToString(o),s=getNodeName(r),n=`${COLON}${s}${BRACKET.PARENTHESES.LEFT}${e}${BRACKET.PARENTHESES.RIGHT}`;return t.value=`${getNodeValue(t)}${n}`,null}const s=optimizeSelectorListNode(o),n=updateNodeChildren(r,[s]);return updateNodeChildren(e,[n])},optimizeCurrentRegularSelector=(e,t)=>{t.value=`${getNodeValue(t)}${SPACE}${getNodeValue(e)}`},optimizeSelectorNode=e=>{const t=e.children,r=[];let o=0;for(;o<t.length;){const e=getItemByIndex(t,o,"currentChild should be specified");if(0===o)r.push(e);else{const t=getLastRegularChild(r);if(isExtendedSelectorNode(e)){let o=null,s=shouldOptimizeExtendedSelector(e);for(o=e;s;)o=getOptimizedExtendedSelector(o,t),s=shouldOptimizeExtendedSelector(o);if(null!==o){r.push(o);const e=getPseudoClassNode(o),s=getNodeName(e);getNodeValue(t)===ASTERISK&&isOptimizationPseudoClass(s)&&(t.value=IS_OR_NOT_PSEUDO_SELECTING_ROOT)}}else if(isRegularSelectorNode(e)){const o=getLast(r)||null;isRegularSelectorNode(o)&&optimizeCurrentRegularSelector(e,t)}}o+=1}return updateNodeChildren(e,r)},optimizeSelectorListNode=e=>updateNodeChildren(e,e.children.map((e=>optimizeSelectorNode(e)))),optimizeAst=e=>optimizeSelectorListNode(e),XPATH_PSEUDO_SELECTING_ROOT="body",NO_WHITESPACE_ERROR_PREFIX="No white space is allowed before or after extended pseudo-class name in selector",parse=e=>{const t=tokenizeSelector(e),r={ast:null,pathToBufferNode:[],extendedPseudoNamesStack:[],extendedPseudoBracketsStack:[],standardPseudoNamesStack:[],standardPseudoBracketsStack:[],isAttributeBracketsOpen:!1,attributeBuffer:"",isRegexpOpen:!1,shouldOptimize:!1};let o=0;for(;o<t.length;){const s=t[o];if(!s)break;const{type:n,value:i}=s,l=t[o+1],a=null==l?void 0:l.type,E=null==l?void 0:l.value,c=t[o+2],u=null==c?void 0:c.value,d=t[o-1],S=null==d?void 0:d.type,R=null==d?void 0:d.value,p=t[o-2],T=null==p?void 0:p.value;let f=getBufferNode(r);switch(n){case TOKEN_TYPE.WORD:if(null===f)initAst(r,i);else if(isSelectorListNode(f))addAstNodeByType(r,NODE.SELECTOR),addAstNodeByType(r,NODE.REGULAR_SELECTOR,i);else if(isRegularSelectorNode(f))updateBufferNode(r,i);else if(isExtendedSelectorNode(f)){if(isWhiteSpaceChar(E)&&u===BRACKET.PARENTHESES.LEFT)throw new Error(`${NO_WHITESPACE_ERROR_PREFIX}: '${e}'`);const t=i.toLowerCase();r.extendedPseudoNamesStack.push(t),isAbsolutePseudoClass(t)?addAstNodeByType(r,NODE.ABSOLUTE_PSEUDO_CLASS,t):(addAstNodeByType(r,NODE.RELATIVE_PSEUDO_CLASS,t),isOptimizationPseudoClass(t)&&(r.shouldOptimize=!0))}else isAbsolutePseudoClassNode(f)?updateBufferNode(r,i):isRelativePseudoClassNode(f)&&initRelativeSubtree(r,i);break;case TOKEN_TYPE.MARK:switch(i){case COMMA:if(!f||void 0!==f&&!E)throw new Error(`'${e}' is not a valid selector`);isRegularSelectorNode(f)?r.isAttributeBracketsOpen?updateBufferNode(r,i):upToClosest(r,NODE.SELECTOR_LIST):isAbsolutePseudoClassNode(f)?updateBufferNode(r,i):isSelectorNode(f)&&upToClosest(r,NODE.SELECTOR_LIST);break;case SPACE:if(isRegularSelectorNode(f)&&!r.isAttributeBracketsOpen&&(f=getUpdatedBufferNode(r)),isRegularSelectorNode(f)){if(!r.isAttributeBracketsOpen&&(R===COLON&&a===TOKEN_TYPE.WORD||S===TOKEN_TYPE.WORD&&E===BRACKET.PARENTHESES.LEFT))throw new Error(`'${e}' is not a valid selector`);(!E||doesRegularContinueAfterSpace(a,E)||r.isAttributeBracketsOpen)&&updateBufferNode(r,i)}isAbsolutePseudoClassNode(f)&&updateBufferNode(r,i),isRelativePseudoClassNode(f)&&initRelativeSubtree(r),isSelectorNode(f)&&doesRegularContinueAfterSpace(a,E)&&addAstNodeByType(r,NODE.REGULAR_SELECTOR);break;case DESCENDANT_COMBINATOR:case CHILD_COMBINATOR:case NEXT_SIBLING_COMBINATOR:case SUBSEQUENT_SIBLING_COMBINATOR:case SEMICOLON:case SLASH:case BACKSLASH:case SINGLE_QUOTE:case DOUBLE_QUOTE:case CARET:case DOLLAR_SIGN:case BRACKET.CURLY.LEFT:case BRACKET.CURLY.RIGHT:case ASTERISK:case ID_MARKER:case CLASS_MARKER:case BRACKET.SQUARE.LEFT:if(COMBINATORS.includes(i)){if(null===f)throw new Error(`'${e}' is not a valid selector`);f=getUpdatedBufferNode(r)}if(null===f)initAst(r,i),isAttributeOpening(i,R)&&(r.isAttributeBracketsOpen=!0);else if(isRegularSelectorNode(f)){if(i===BRACKET.CURLY.LEFT&&!r.isAttributeBracketsOpen&&!r.isRegexpOpen)throw new Error(`'${e}' is not a valid selector`);updateBufferNode(r,i),isAttributeOpening(i,R)&&(r.isAttributeBracketsOpen=!0)}else isAbsolutePseudoClassNode(f)?(updateBufferNode(r,i),i===SLASH&&r.extendedPseudoNamesStack.length>0&&(R===SLASH&&T===BACKSLASH?r.isRegexpOpen=!1:R&&R!==BACKSLASH&&(isRegexpOpening(r,R,getNodeValue(f))?r.isRegexpOpen=!r.isRegexpOpen:r.isRegexpOpen=!1))):isRelativePseudoClassNode(f)?(initRelativeSubtree(r,i),isAttributeOpening(i,R)&&(r.isAttributeBracketsOpen=!0)):isSelectorNode(f)?COMBINATORS.includes(i)?addAstNodeByType(r,NODE.REGULAR_SELECTOR,i):r.isRegexpOpen||(f=getContextLastRegularSelectorNode(r),updateBufferNode(r,i),isAttributeOpening(i,R)&&(r.isAttributeBracketsOpen=!0)):isSelectorListNode(f)&&(addAstNodeByType(r,NODE.SELECTOR),addAstNodeByType(r,NODE.REGULAR_SELECTOR,i),isAttributeOpening(i,R)&&(r.isAttributeBracketsOpen=!0));break;case BRACKET.SQUARE.RIGHT:if(isRegularSelectorNode(f)){if(!r.isAttributeBracketsOpen&&R!==BACKSLASH)throw new Error(`'${e}' is not a valid selector due to '${i}' after '${getNodeValue(f)}'`);isAttributeClosing(r)&&(r.isAttributeBracketsOpen=!1,r.attributeBuffer=""),updateBufferNode(r,i)}isAbsolutePseudoClassNode(f)&&updateBufferNode(r,i);break;case COLON:if(isWhiteSpaceChar(E)&&u&&SUPPORTED_PSEUDO_CLASSES.includes(u))throw new Error(`${NO_WHITESPACE_ERROR_PREFIX}: '${e}'`);if(null===f){if(E===XPATH_PSEUDO_CLASS_MARKER)initAst(r,XPATH_PSEUDO_SELECTING_ROOT);else{if(E===UPWARD_PSEUDO_CLASS_MARKER||E===NTH_ANCESTOR_PSEUDO_CLASS_MARKER)throw new Error(`${NO_SELECTOR_ERROR_PREFIX} before :${E}() pseudo-class`);initAst(r,ASTERISK)}f=getBufferNode(r)}if(isSelectorListNode(f)&&(addAstNodeByType(r,NODE.SELECTOR),addAstNodeByType(r,NODE.REGULAR_SELECTOR),f=getBufferNode(r)),isRegularSelectorNode(f)&&((R&&COMBINATORS.includes(R)||R===COMMA)&&updateBufferNode(r,ASTERISK),handleNextTokenOnColon(r,e,i,E,u)),isSelectorNode(f)){if(!E)throw new Error(`Invalid colon ':' at the end of selector: '${e}'`);if(isSupportedPseudoClass(E.toLowerCase()))addAstNodeByType(r,NODE.EXTENDED_SELECTOR);else{if(E.toLowerCase()===REMOVE_PSEUDO_MARKER)throw new Error(`${REMOVE_ERROR_PREFIX.INVALID_REMOVE}: '${e}'`);f=getContextLastRegularSelectorNode(r),handleNextTokenOnColon(r,e,i,a,u)}}if(isAbsolutePseudoClassNode(f)){if(getNodeName(f)===XPATH_PSEUDO_CLASS_MARKER&&E&&SUPPORTED_PSEUDO_CLASSES.includes(E)&&u===BRACKET.PARENTHESES.LEFT)throw new Error(`:xpath() pseudo-class should be the last in selector: '${e}'`);updateBufferNode(r,i)}if(isRelativePseudoClassNode(f)){if(!E)throw new Error(`Invalid pseudo-class arg at the end of selector: '${e}'`);initRelativeSubtree(r,ASTERISK),isSupportedPseudoClass(E.toLowerCase())?(upToClosest(r,NODE.SELECTOR),addAstNodeByType(r,NODE.EXTENDED_SELECTOR)):(updateBufferNode(r,i),u===BRACKET.PARENTHESES.LEFT&&r.standardPseudoNamesStack.push(E))}break;case BRACKET.PARENTHESES.LEFT:isAbsolutePseudoClassNode(f)&&(getNodeName(f)!==XPATH_PSEUDO_CLASS_MARKER&&r.isRegexpOpen?updateBufferNode(r,i):(r.extendedPseudoBracketsStack.push(i),r.extendedPseudoBracketsStack.length>r.extendedPseudoNamesStack.length&&updateBufferNode(r,i))),isRegularSelectorNode(f)&&(r.standardPseudoNamesStack.length>0&&(updateBufferNode(r,i),r.standardPseudoBracketsStack.push(i)),r.isAttributeBracketsOpen&&updateBufferNode(r,i)),isRelativePseudoClassNode(f)&&r.extendedPseudoBracketsStack.push(i);break;case BRACKET.PARENTHESES.RIGHT:if(isAbsolutePseudoClassNode(f)&&(getNodeName(f)!==XPATH_PSEUDO_CLASS_MARKER&&r.isRegexpOpen?updateBufferNode(r,i):(r.extendedPseudoBracketsStack.pop(),getNodeName(f)!==XPATH_PSEUDO_CLASS_MARKER?(r.extendedPseudoNamesStack.pop(),r.extendedPseudoBracketsStack.length>r.extendedPseudoNamesStack.length?updateBufferNode(r,i):r.extendedPseudoBracketsStack.length>=0&&r.extendedPseudoNamesStack.length>=0&&upToClosest(r,NODE.SELECTOR)):r.extendedPseudoBracketsStack.length<r.extendedPseudoNamesStack.length?r.extendedPseudoNamesStack.pop():updateBufferNode(r,i))),isRegularSelectorNode(f))if(r.isAttributeBracketsOpen)updateBufferNode(r,i);else if(r.standardPseudoNamesStack.length>0&&r.standardPseudoBracketsStack.length>0){updateBufferNode(r,i),r.standardPseudoBracketsStack.pop();const t=r.standardPseudoNamesStack.pop();if(!t)throw new Error(`Parsing error. Invalid selector: ${e}`);if(Object.values(REGULAR_PSEUDO_ELEMENTS).includes(t)&&E===COLON&&u&&HAS_PSEUDO_CLASS_MARKERS.includes(u))throw new Error(`Usage of :${u}() pseudo-class is not allowed after any regular pseudo-element: '${t}'`)}else r.extendedPseudoBracketsStack.pop(),r.extendedPseudoNamesStack.pop(),upToClosest(r,NODE.EXTENDED_SELECTOR),upToClosest(r,NODE.SELECTOR);isSelectorNode(f)&&(r.extendedPseudoBracketsStack.pop(),r.extendedPseudoNamesStack.pop(),upToClosest(r,NODE.EXTENDED_SELECTOR),upToClosest(r,NODE.SELECTOR)),isRelativePseudoClassNode(f)&&r.extendedPseudoNamesStack.length>0&&r.extendedPseudoBracketsStack.length>0&&(r.extendedPseudoBracketsStack.pop(),r.extendedPseudoNamesStack.pop());break;case LINE_FEED:case FORM_FEED:case CARRIAGE_RETURN:throw new Error(`'${e}' is not a valid selector`);case TAB:if(!isRegularSelectorNode(f)||!r.isAttributeBracketsOpen)throw new Error(`'${e}' is not a valid selector`);updateBufferNode(r,i)}break;default:throw new Error(`Unknown type of token: '${i}'`)}o+=1}if(null===r.ast)throw new Error(`'${e}' is not a valid selector`);if(r.extendedPseudoNamesStack.length>0||r.extendedPseudoBracketsStack.length>0)throw new Error(`Unbalanced brackets for extended pseudo-class: '${getLast(r.extendedPseudoNamesStack)}'`);if(r.isAttributeBracketsOpen)throw new Error(`Unbalanced attribute brackets in selector: '${e}'`);return r.shouldOptimize?optimizeAst(r.ast):r.ast},natives={MutationObserver:window.MutationObserver||window.WebKitMutationObserver};class NativeTextContent{constructor(){this.nativeNode=window.Node||Node}setGetter(){var e;this.getter=null===(e=Object.getOwnPropertyDescriptor(this.nativeNode.prototype,"textContent"))||void 0===e?void 0:e.get}}const nativeTextContent=new NativeTextContent,getNodeTextContent=e=>nativeTextContent.getter?nativeTextContent.getter.apply(e):e.textContent||"",getElementSelectorDesc=e=>{let t=e.tagName.toLowerCase();return t+=Array.from(e.attributes).map((t=>`[${t.name}="${e.getAttribute(t.name)}"]`)).join(""),t},getElementSelectorPath=e=>{if(!(e instanceof Element))throw new Error("Function received argument with wrong type");let t;t=e;const r=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id&&"string"==typeof t.id){e+=`#${t.id}`,r.unshift(e);break}let o=t,s=1;for(;o.previousElementSibling;)o=o.previousElementSibling,o.nodeType===Node.ELEMENT_NODE&&o.nodeName.toLowerCase()===e&&(s+=1);1!==s&&(e+=`:nth-of-type(${s})`),r.unshift(e),t=t.parentElement}return r.join(" > ")},isHtmlElement=e=>e instanceof HTMLElement,getParent=(e,t)=>{const{parentElement:r}=e;if(!r)throw new Error(t||"Element does no have parent element");return r},isErrorWithMessage=e=>"object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message,toErrorWithMessage=e=>{if(isErrorWithMessage(e))return e;try{return new Error(JSON.stringify(e))}catch{return new Error(String(e))}},getErrorMessage=e=>toErrorWithMessage(e).message,logger={error:"undefined"!=typeof console&&console.error&&console.error.bind?console.error.bind(window.console):console.error,info:"undefined"!=typeof console&&console.info&&console.info.bind?console.info.bind(window.console):console.info},removeSuffix=(e,t)=>{const r=e.indexOf(t,e.length-t.length);return r>=0?e.substring(0,r):e},replaceAll=(e,t,r)=>e?e.split(t).join(r):e,toRegExp=e=>{if(e.startsWith(SLASH)&&e.endsWith(SLASH))return new RegExp(e.slice(1,-1));const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(t)},convertTypeIntoString=e=>{let t;switch(e){case void 0:t="undefined";break;case null:t="null";break;default:t=e.toString()}return t},convertTypeFromString=e=>{const t=Number(e);let r;if(Number.isNaN(t))switch(e){case"undefined":r=void 0;break;case"null":r=null;break;case"true":r=!0;break;case"false":r=!1;break;default:r=e}else r=t;return r},SAFARI_USER_AGENT_REGEXP=/\sVersion\/(\d{2}\.\d)(.+\s|\s)(Safari)\//,isSafariBrowser=SAFARI_USER_AGENT_REGEXP.test(navigator.userAgent),isUserAgentSupported=e=>!e.includes("MSIE")&&!e.includes("Trident/"),isBrowserSupported=()=>isUserAgentSupported(navigator.userAgent),CSS_PROPERTY={BACKGROUND:"background",BACKGROUND_IMAGE:"background-image",CONTENT:"content",OPACITY:"opacity"},REGEXP_ANY_SYMBOL=".*",REGEXP_WITH_FLAGS_REGEXP=/^\s*\/.*\/[gmisuy]*\s*$/,removeContentQuotes=e=>e.replace(/^(["'])([\s\S]*)\1$/,"$2"),addUrlPropertyQuotes=e=>{if(!e.includes('url("')){const t=/url\((.*?)\)/g;return e.replace(t,'url("$1")')}return e},addUrlQuotesTo={regexpArg:e=>e.replace(/(\^)?url(\\)?\\\((\w|\[\w)/g,'$1url$2\\(\\"?$3'),noneRegexpArg:addUrlPropertyQuotes},escapeRegExp=e=>{const t=new RegExp(`[${[".","+","?","$","{","}","(",")","[","]","\\","/"].join("\\")}]`,"g");return e.replace(t,"\\$&")},convertStyleMatchValueToRegexp=e=>{let t;return e.startsWith(SLASH)&&e.endsWith(SLASH)?(t=addUrlQuotesTo.regexpArg(e),t=t.slice(1,-1)):(t=addUrlQuotesTo.noneRegexpArg(e),t=t.replace(/\\([\\()[\]"])/g,"$1"),t=escapeRegExp(t),t=replaceAll(t,ASTERISK,REGEXP_ANY_SYMBOL)),new RegExp(t,"i")},normalizePropertyValue=(e,t)=>{let r="";switch(e){case CSS_PROPERTY.BACKGROUND:case CSS_PROPERTY.BACKGROUND_IMAGE:r=addUrlPropertyQuotes(t);break;case CSS_PROPERTY.CONTENT:r=removeContentQuotes(t);break;case CSS_PROPERTY.OPACITY:r=isSafariBrowser?(Math.round(100*parseFloat(t))/100).toString():t;break;default:r=t}return r},getComputedStylePropertyValue=(e,t,r)=>{const o=window.getComputedStyle(e,r).getPropertyValue(t);return normalizePropertyValue(t,o)},getPseudoArgData=(e,t)=>{const r=e.indexOf(t);let o,s;return r>-1?(o=e.substring(0,r).trim(),s=e.substring(r+1).trim()):o=e,{name:o,value:s}},parseStyleMatchArg=(e,t)=>{const{name:r,value:o}=getPseudoArgData(t,COMMA);let s=r,n=o;if(Object.values(REGULAR_PSEUDO_ELEMENTS).includes(r)||(s=null,n=t),!n)throw new Error(`Required style property argument part is missing in :${e}() arg: '${t}'`);return s&&(s=`${COLON}${COLON}${s}`),{regularPseudoElement:s,styleMatchArg:n}},isStyleMatched=e=>{const{pseudoName:t,pseudoArg:r,domElement:o}=e,{regularPseudoElement:s,styleMatchArg:n}=parseStyleMatchArg(t,r),{name:i,value:l}=getPseudoArgData(n,COLON);if(!i||!l)throw new Error(`Required property name or value is missing in :${t}() arg: '${n}'`);let a;try{a=convertStyleMatchValueToRegexp(l)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`Invalid argument of :${t}() pseudo-class: '${n}'`)}const E=getComputedStylePropertyValue(o,i,s);return a&&a.test(E)},validateStrMatcherArg=e=>!e.includes(SLASH)&&!!/^[\w-]+$/.test(e),getValidMatcherArg=function(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length>1&&e.startsWith(DOUBLE_QUOTE)&&e.endsWith(DOUBLE_QUOTE)&&(e=e.slice(1,-1)),""===e)throw new Error("Argument should be specified. Empty arg is invalid.");if(e.startsWith(SLASH)&&e.endsWith(SLASH)){if(!(e.length>2))throw new Error(`Invalid regexp: '${e}'`);t=toRegExp(e)}else if(e.includes(ASTERISK)){if(e===ASTERISK&&!r)throw new Error(`Argument should be more specific than ${e}`);t=replaceAll(e,ASTERISK,REGEXP_ANY_SYMBOL),t=new RegExp(t)}else{if(!validateStrMatcherArg(e))throw new Error(`Invalid argument: '${e}'`);t=e}return t},getRawMatchingData=(e,t)=>{const{name:r,value:o}=getPseudoArgData(t,EQUAL_SIGN);if(!r)throw new Error(`Required attribute name is missing in :${e} arg: ${t}`);return{rawName:r,rawValue:o}},isAttributeMatched=e=>{const{pseudoName:t,pseudoArg:r,domElement:o}=e,s=o.attributes;if(0===s.length)return!1;const{rawName:n,rawValue:i}=getRawMatchingData(t,r);let l;try{l=getValidMatcherArg(n)}catch(e){const t=getErrorMessage(e);throw logger.error(t),new SyntaxError(t)}let a=!1,E=0;for(;E<s.length&&!a;){const e=s[E];if(!e)break;const t=l instanceof RegExp?l.test(e.name):l===e.name;if(i){let r;try{r=getValidMatcherArg(i)}catch(e){const t=getErrorMessage(e);throw logger.error(t),new SyntaxError(t)}const o=r instanceof RegExp?r.test(e.value):r===e.value;a=t&&o}else a=t;E+=1}return a},parseRawPropChain=e=>{e.length>1&&e.startsWith(DOUBLE_QUOTE)&&e.endsWith(DOUBLE_QUOTE)&&(e=e.slice(1,-1));const t=e.split(DOT),r=[];let o="",s=!1,n=0;for(;n<t.length;){const i=getItemByIndex(t,n,`Invalid pseudo-class arg: '${e}'`);i.startsWith(SLASH)&&i.endsWith(SLASH)&&i.length>2?r.push(i):i.startsWith(SLASH)?(s=!0,o+=i):i.endsWith(SLASH)?(s=!1,o+=`.${i}`,r.push(o),o=""):s?o+=i:r.push(i),n+=1}if(o.length>0)throw new Error(`Invalid regexp property pattern '${e}'`);return r.map((t=>{if(0===t.length)throw new Error(`Empty pattern '${t}' is invalid in chain '${e}'`);let r;try{r=getValidMatcherArg(t,!0)}catch(r){throw logger.error(getErrorMessage(r)),new Error(`Invalid property pattern '${t}' in property chain '${e}'`)}return r}))},filterRootsByRegexpChain=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const o=getFirst(t);if(1===t.length){let t;for(t in e)o instanceof RegExp?o.test(t)&&r.push({base:e,prop:t,value:e[t]}):o===t&&r.push({base:e,prop:o,value:e[t]});return r}if(o instanceof RegExp){const s=t.slice(1),n=[];for(const t in e)o.test(t)&&n.push(t);n.forEach((t=>{var o;const n=null===(o=Object.getOwnPropertyDescriptor(e,t))||void 0===o?void 0:o.value;filterRootsByRegexpChain(n,s,r)}))}if(e&&"string"==typeof o){var s;const n=null===(s=Object.getOwnPropertyDescriptor(e,o))||void 0===s?void 0:s.value;t=t.slice(1),void 0!==n&&filterRootsByRegexpChain(n,t,r)}return r},isPropertyMatched=e=>{const{pseudoName:t,pseudoArg:r,domElement:o}=e,{rawName:s,rawValue:n}=getRawMatchingData(t,r);if(s.includes("\\/")||s.includes("\\."))throw new Error(`Invalid :${t} name pattern: ${s}`);let i;try{i=parseRawPropChain(s)}catch(e){const t=getErrorMessage(e);throw logger.error(t),new SyntaxError(t)}const l=filterRootsByRegexpChain(o,i);if(0===l.length)return!1;let a=!0;if(n){let e;try{e=getValidMatcherArg(n)}catch(e){const t=getErrorMessage(e);throw logger.error(t),new SyntaxError(t)}if(e)for(let t=0;t<l.length;t+=1){var E;const r=null===(E=l[t])||void 0===E?void 0:E.value;if(e instanceof RegExp)a=e.test(convertTypeIntoString(r));else{if("null"===r||"undefined"===r){a=e===r;break}a=convertTypeFromString(e)===r}if(a)break}}return a},isTextMatched=e=>{const{pseudoName:t,pseudoArg:r,domElement:o}=e,s=getNodeTextContent(o);let n,i=r;if(i.startsWith(SLASH)&&REGEXP_WITH_FLAGS_REGEXP.test(i)){const e=i.lastIndexOf("/"),o=i.substring(e+1);let l;i=i.substring(0,e+1).slice(1,-1).replace(/\\([\\"])/g,"$1");try{l=new RegExp(i,o)}catch(e){throw new Error(`Invalid argument of :${t}() pseudo-class: ${r}`)}n=l.test(s)}else i=i.replace(/\\([\\()[\]"])/g,"$1"),n=s.includes(i);return n},getValidNumberAncestorArg=(e,t)=>{const r=Number(e);if(Number.isNaN(r)||r<1||r>=256)throw new Error(`Invalid argument of :${t} pseudo-class: '${e}'`);return r},getNthAncestor=(e,t,r)=>{let o=null,s=0;for(;s<t;){if(o=e.parentElement,!o)throw new Error(`Out of DOM: Argument of :${r}() pseudo-class is too big — '${t}'.`);e=o,s+=1}return o},validateStandardSelector=e=>{let t;try{document.querySelectorAll(e),t=!0}catch(e){t=!1}return t},matcherWrapper=(e,t,r)=>{let o;try{o=e(t)}catch(e){throw logger.error(getErrorMessage(e)),new Error(r)}return o},getAbsolutePseudoError=(e,t,r)=>`${MATCHING_ELEMENT_ERROR_PREFIX} ${e}, may be invalid :${t}() pseudo-class arg: '${r}'`,isMatchedByAbsolutePseudo=(e,t,r)=>{let o,s,n;switch(t){case CONTAINS_PSEUDO:case HAS_TEXT_PSEUDO:case ABP_CONTAINS_PSEUDO:n=isTextMatched,o={pseudoName:t,pseudoArg:r,domElement:e},s=getAbsolutePseudoError("text content",t,r);break;case MATCHES_CSS_PSEUDO:case MATCHES_CSS_AFTER_PSEUDO:case MATCHES_CSS_BEFORE_PSEUDO:n=isStyleMatched,o={pseudoName:t,pseudoArg:r,domElement:e},s=getAbsolutePseudoError("style",t,r);break;case MATCHES_ATTR_PSEUDO_CLASS_MARKER:n=isAttributeMatched,o={domElement:e,pseudoName:t,pseudoArg:r},s=getAbsolutePseudoError("attributes",t,r);break;case MATCHES_PROPERTY_PSEUDO_CLASS_MARKER:n=isPropertyMatched,o={domElement:e,pseudoName:t,pseudoArg:r},s=getAbsolutePseudoError("properties",t,r);break;default:throw new Error(`Unknown absolute pseudo-class :${t}()`)}return matcherWrapper(n,o,s)},findByAbsolutePseudoPseudo={nthAncestor:(e,t,r)=>{const o=getValidNumberAncestorArg(t,r);return e.map((e=>{let t=null;try{t=getNthAncestor(e,o,r)}catch(e){logger.error(getErrorMessage(e))}return t})).filter(isHtmlElement)},xpath:(e,t)=>{const r=e.map((e=>{const r=[];let o;try{o=document.evaluate(t,e,null,window.XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`Invalid argument of :xpath() pseudo-class: '${t}'`)}let s=o.iterateNext();for(;s;)isHtmlElement(s)&&r.push(s),s=o.iterateNext();return r}));return flatten(r)},upward:(e,t)=>{if(!validateStandardSelector(t))throw new Error(`Invalid argument of :upward pseudo-class: '${t}'`);return e.map((e=>{const r=e.parentElement;return r?r.closest(t):null})).filter(isHtmlElement)}},scopeDirectChildren=`${SCOPE_CSS_PSEUDO_CLASS}${CHILD_COMBINATOR}`,scopeAnyChildren=`${SCOPE_CSS_PSEUDO_CLASS}${DESCENDANT_COMBINATOR}`,getFirstInnerRegularChild=(e,t)=>getFirstRegularChild(e.children,`RegularSelector is missing for :${t}() pseudo-class`),hasRelativesBySelectorList=e=>{const{element:t,relativeSelectorList:r,pseudoName:o}=e;return r.children.every((e=>{const r=getFirstInnerRegularChild(e,o);let s="",n=null;const i=getNodeValue(r);if(i.startsWith(NEXT_SIBLING_COMBINATOR)||i.startsWith(SUBSEQUENT_SIBLING_COMBINATOR)){n=t.parentElement;const e=getElementSelectorDesc(t);s=`${scopeDirectChildren}${e}${i}`}else i===ASTERISK?(n=t,s=`${scopeAnyChildren}${ASTERISK}`):(s=`${scopeAnyChildren}${i}`,n=t);if(!n)throw new Error(`Selection by :${o}() pseudo-class is not possible`);let l;try{l=getElementsForSelectorNode(e,n,s)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`Invalid selector for :${o}() pseudo-class: '${i}'`)}return l.length>0}))},isAnyElementBySelectorList=e=>{const{element:t,relativeSelectorList:r,pseudoName:o}=e;return r.children.some((e=>{const r=getFirstInnerRegularChild(e,o),s=getParent(t,`Selection by :${o}() pseudo-class is not possible`),n=`${scopeDirectChildren}${getNodeValue(r)}`;let i;try{i=getElementsForSelectorNode(e,s,n)}catch(e){return!1}return i.includes(t)}))},notElementBySelectorList=e=>{const{element:t,relativeSelectorList:r,pseudoName:o}=e;return r.children.every((e=>{const r=getFirstInnerRegularChild(e,o),s=getParent(t,`Selection by :${o}() pseudo-class is not possible`),n=`${scopeDirectChildren}${getNodeValue(r)}`;let i;try{i=getElementsForSelectorNode(e,s,n)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`Invalid selector for :${o}() pseudo-class: '${getNodeValue(r)}'`)}return!i.includes(t)}))},getByRegularSelector=(e,t,r)=>{const o=r||getNodeValue(e);let s=[];try{s=Array.from(t.querySelectorAll(o))}catch(e){throw new Error(`Error: unable to select by '${o}' — ${getErrorMessage(e)}`)}return s},getByExtendedSelector=(e,t)=>{let r=[];const o=getPseudoClassNode(t),s=getNodeName(o);if(isAbsolutePseudoClass(s)){const t=getNodeValue(o,`Missing arg for :${s}() pseudo-class`);if(s===NTH_ANCESTOR_PSEUDO_CLASS_MARKER)r=findByAbsolutePseudoPseudo.nthAncestor(e,t,s);else if(s===XPATH_PSEUDO_CLASS_MARKER){try{document.createExpression(t,null)}catch(e){throw new Error(`Invalid argument of :${s}() pseudo-class: '${t}'`)}r=findByAbsolutePseudoPseudo.xpath(e,t)}else r=s===UPWARD_PSEUDO_CLASS_MARKER?Number.isNaN(Number(t))?findByAbsolutePseudoPseudo.upward(e,t):findByAbsolutePseudoPseudo.nthAncestor(e,t,s):e.filter((e=>isMatchedByAbsolutePseudo(e,s,t)))}else{if(!isRelativePseudoClass(s))throw new Error(`Unknown extended pseudo-class: '${s}'`);{const t=getRelativeSelectorListNode(o);let n;switch(s){case HAS_PSEUDO_CLASS_MARKER:case ABP_HAS_PSEUDO_CLASS_MARKER:n=e=>hasRelativesBySelectorList({element:e,relativeSelectorList:t,pseudoName:s});break;case IS_PSEUDO_CLASS_MARKER:n=e=>isAnyElementBySelectorList({element:e,relativeSelectorList:t,pseudoName:s});break;case NOT_PSEUDO_CLASS_MARKER:n=e=>notElementBySelectorList({element:e,relativeSelectorList:t,pseudoName:s});break;default:throw new Error(`Unknown relative pseudo-class: '${s}'`)}r=e.filter(n)}}return r},getByFollowingRegularSelector=(e,t)=>{let r=[];const o=getNodeValue(t);return r=o.startsWith(CHILD_COMBINATOR)?e.map((e=>getByRegularSelector(t,e,`${SCOPE_CSS_PSEUDO_CLASS}${o}`))):o.startsWith(NEXT_SIBLING_COMBINATOR)||o.startsWith(SUBSEQUENT_SIBLING_COMBINATOR)?e.map((e=>{const r=e.parentElement;if(!r)return[];const s=getElementSelectorDesc(e);return getByRegularSelector(t,r,`${scopeDirectChildren}${s}${o}`)})):e.map((e=>{const r=`${scopeAnyChildren}${getNodeValue(t)}`;return getByRegularSelector(t,e,r)})),flatten(r)},getElementsForSelectorNode=(e,t,r)=>{let o=[],s=0;for(;s<e.children.length;){const n=getItemByIndex(e.children,s,"selectorNodeChild should be specified");0===s?o=getByRegularSelector(n,t,r):isExtendedSelectorNode(n)?o=getByExtendedSelector(o,n):isRegularSelectorNode(n)&&(o=getByFollowingRegularSelector(o,n)),s+=1}return o},selectElementsByAst=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r=[];e.children.forEach((e=>{r.push(...getElementsForSelectorNode(e,t))}));const o=[...new Set(flatten(r))];return o};class ExtCssDocument{constructor(){this.astCache=new Map}saveAstToCache(e,t){this.astCache.set(e,t)}getAstFromCache(e){return this.astCache.get(e)||null}getSelectorAst(e){let t=this.getAstFromCache(e);return t||(t=parse(e)),this.saveAstToCache(e,t),t}querySelectorAll(e){const t=this.getSelectorAst(e);return selectElementsByAst(t)}}const extCssDocument=new ExtCssDocument,getObjectFromEntries=e=>{const t={};return e.forEach((e=>{const[r,o]=e;t[r]=o})),t},DEBUG_PSEUDO_PROPERTY_KEY="debug",parseRemoveSelector=e=>{const t=`${COLON}${REMOVE_PSEUDO_MARKER}${BRACKET.PARENTHESES.LEFT}${BRACKET.PARENTHESES.RIGHT}`,r=`${COLON}${REMOVE_PSEUDO_MARKER}${BRACKET.PARENTHESES.LEFT}`;let o,s=!1;const n=e.indexOf(t);if(0===n)throw new Error(`${REMOVE_ERROR_PREFIX.NO_TARGET_SELECTOR}: '${e}'`);if(n>0){if(n!==e.lastIndexOf(t))throw new Error(`${REMOVE_ERROR_PREFIX.MULTIPLE_USAGE}: '${e}'`);if(n+t.length<e.length)throw new Error(`${REMOVE_ERROR_PREFIX.INVALID_POSITION}: '${e}'`);o=e.substring(0,n),s=!0}else{if(e.includes(r))throw new Error(`${REMOVE_ERROR_PREFIX.INVALID_REMOVE}: '${e}'`);o=e}return{selector:o,stylesOfSelector:s?[{property:REMOVE_PSEUDO_MARKER,value:PSEUDO_PROPERTY_POSITIVE_VALUE}]:[]}},parseSelectorRulePart=(e,t)=>{let r,o=e.trim();if(o.startsWith(AT_RULE_MARKER))throw new Error(`${NO_AT_RULE_ERROR_PREFIX}: '${o}'.`);try{r=parseRemoveSelector(o)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`${REMOVE_ERROR_PREFIX.INVALID_REMOVE}: '${o}'`)}let s,n=[],i=!1;try{o=r.selector,n=r.stylesOfSelector,s=t.getSelectorAst(o),i=!0}catch(e){i=!1}return{success:i,selector:o,ast:s,stylesOfSelector:n}},createRawResultsMap=()=>new Map,saveToRawResults=(e,t)=>{const{selector:r,ast:o,rawStyles:s}=t;if(!s)throw new Error(`No style declaration for selector: '${r}'`);if(!o)throw new Error(`No ast parsed for selector: '${r}'`);const n=e.get(r);n?n.styles.push(...s):e.set(r,{ast:o,styles:s})},isRemoveSetInStyles=e=>e.some((e=>e.property===REMOVE_PSEUDO_MARKER&&e.value===PSEUDO_PROPERTY_POSITIVE_VALUE)),getDebugStyleValue=e=>{const t=e.find((e=>e.property===DEBUG_PSEUDO_PROPERTY_KEY));return null==t?void 0:t.value},prepareRuleData=e=>{const{selector:t,ast:r,rawStyles:o}=e;if(!r)throw new Error(`AST should be parsed for selector: '${t}'`);if(!o)throw new Error(`Styles should be parsed for selector: '${t}'`);const s={selector:t,ast:r},n=getDebugStyleValue(o),i=isRemoveSetInStyles(o);let l=o;if(n&&(l=o.filter((e=>e.property!==DEBUG_PSEUDO_PROPERTY_KEY)),n!==PSEUDO_PROPERTY_POSITIVE_VALUE&&n!==DEBUG_PSEUDO_PROPERTY_GLOBAL_VALUE||(s.debug=n)),i){s.style={[REMOVE_PSEUDO_MARKER]:PSEUDO_PROPERTY_POSITIVE_VALUE};const e=l.find((e=>e.property===CONTENT_CSS_PROPERTY));e&&(s.style[CONTENT_CSS_PROPERTY]=e.value)}else if(l.length>0){const e=l.map((e=>{const{property:t,value:r}=e;return[t,r]})),t=getObjectFromEntries(e);s.style=t}return s},combineRulesData=e=>{const t=[];return e.forEach(((e,r)=>{const o=r,{ast:s,styles:n}=e;t.push(prepareRuleData({selector:o,ast:s,rawStyles:n}))})),t},tokenizeStyleBlock=e=>{const t=e.trim();return tokenize(t,SUPPORTED_STYLE_DECLARATION_MARKS)},DECLARATION_PART={PROPERTY:"property",VALUE:"value"},isValueQuotesOpen=e=>""!==e.bufferValue&&null!==e.valueQuoteMark,collectStyle=e=>{e.styles.push({property:e.bufferProperty.trim(),value:e.bufferValue.trim()}),e.bufferProperty="",e.bufferValue=""},processPropertyToken=(e,t,r)=>{const{value:o}=r;switch(r.type){case TOKEN_TYPE.WORD:if(e.bufferProperty.length>0)throw new Error(`Invalid style property in style block: '${t}'`);e.bufferProperty+=o;break;case TOKEN_TYPE.MARK:if(o===COLON){if(0===e.bufferProperty.trim().length)throw new Error(`Missing style property before ':' in style block: '${t}'`);e.bufferProperty=e.bufferProperty.trim(),e.processing=DECLARATION_PART.VALUE}else if(!WHITE_SPACE_CHARACTERS.includes(o))throw new Error(`Invalid style declaration in style block: '${t}'`);break;default:throw new Error(`Unsupported style property character: '${o}' in style block: '${t}'`)}},processValueToken=(e,t,r)=>{const{value:o}=r;if(r.type===TOKEN_TYPE.WORD)e.bufferValue+=o;else switch(o){case COLON:if(!isValueQuotesOpen(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=o;break;case SEMICOLON:isValueQuotesOpen(e)?e.bufferValue+=o:(collectStyle(e),e.processing=DECLARATION_PART.PROPERTY);break;case SINGLE_QUOTE:case DOUBLE_QUOTE:null===e.valueQuoteMark?e.valueQuoteMark=o:e.bufferValue.endsWith(BACKSLASH)||e.valueQuoteMark!==o||(e.valueQuoteMark=null),e.bufferValue+=o;break;case BACKSLASH:if(!isValueQuotesOpen(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=o;break;case SPACE:case TAB:case CARRIAGE_RETURN:case LINE_FEED:case FORM_FEED:e.bufferValue.length>0&&(e.bufferValue+=o);break;default:throw new Error(`Unknown style declaration token: '${o}'`)}},parseStyleBlock=e=>{const t=e.trim(),r=tokenizeStyleBlock(t),o={processing:DECLARATION_PART.PROPERTY,styles:[],bufferProperty:"",bufferValue:"",valueQuoteMark:null};let s=0;for(;s<r.length;){const e=r[s];if(!e)break;if(o.processing===DECLARATION_PART.PROPERTY)processPropertyToken(o,t,e);else{if(o.processing!==DECLARATION_PART.VALUE)throw new Error("Style declaration parsing failed");processValueToken(o,t,e)}s+=1}if(isValueQuotesOpen(o))throw new Error(`Unbalanced style declaration quotes in style block: '${t}'`);if(o.bufferProperty.length>0){if(0===o.bufferValue.length)throw new Error(`Missing style value for property '${o.bufferProperty}' in style block '${t}'`);collectStyle(o)}if(0===o.styles.length)throw new Error(STYLE_ERROR_PREFIX.NO_STYLE);return o.styles},getLeftCurlyBracketIndexes=e=>{const t=[];for(let r=0;r<e.length;r+=1)e[r]===BRACKET.CURLY.LEFT&&t.push(r);return t},parseRule=(e,t)=>{var r;const o=e.trim();if(o.includes(`${SLASH}${ASTERISK}`)&&o.includes(`${ASTERISK}${SLASH}`))throw new Error(STYLE_ERROR_PREFIX.NO_COMMENT);const s=getLeftCurlyBracketIndexes(o);if(0===getFirst(s))throw new Error(NO_SELECTOR_ERROR_PREFIX);let n,i,l;if(s.length>0&&!o.includes(BRACKET.CURLY.RIGHT))throw new Error(`${STYLE_ERROR_PREFIX.NO_STYLE} OR ${STYLE_ERROR_PREFIX.UNCLOSED_STYLE}`);if(0===s.length||!o.includes(BRACKET.CURLY.RIGHT))try{if(n=parseSelectorRulePart(o,t),n.success){var a;if(0===(null===(a=n.stylesOfSelector)||void 0===a?void 0:a.length))throw new Error(STYLE_ERROR_PREFIX.NO_STYLE_OR_REMOVE);return{selector:n.selector.trim(),ast:n.ast,rawStyles:n.stylesOfSelector}}throw new Error("Invalid selector")}catch(e){throw new Error(getErrorMessage(e))}const E={selector:""};for(let e=s.length-1;e>-1;e-=1){const r=s[e];if(!r)throw new Error(`Impossible to continue, no '{' to process for rule: '${o}'`);if(i=o.slice(0,r),l=o.slice(r+1,o.length-1),n=parseSelectorRulePart(i,t),n.success){var c;E.selector=n.selector.trim(),E.ast=n.ast,E.rawStyles=n.stylesOfSelector;const e=parseStyleBlock(l);null===(c=E.rawStyles)||void 0===c||c.push(...e);break}}if(0===(null===(r=E.selector)||void 0===r?void 0:r.length))throw new Error("Selector in not valid");return E},parseRules=(e,t)=>{const r=createRawResultsMap(),o=[];return[...new Set(e.map((e=>e.trim())))].forEach((e=>{try{saveToRawResults(r,parseRule(e,t))}catch(t){const r=getErrorMessage(t);o.push(`'${e}' - error: '${r}'`)}})),o.length>0&&logger.info(`Invalid rules:\n  ${o.join("\n  ")}`),combineRulesData(r)},REGEXP_DECLARATION_END=/[;}]/g,REGEXP_DECLARATION_DIVIDER=/[;:}]/g,REGEXP_NON_WHITESPACE=/\S/g,restoreRuleAcc=e=>{e.rawRuleData={selector:""}},parseSelectorPart=(e,t)=>{let r,o=e.selectorBuffer.trim();if(o.startsWith(AT_RULE_MARKER))throw new Error(`${NO_AT_RULE_ERROR_PREFIX}: '${o}'.`);try{r=parseRemoveSelector(o)}catch(e){throw logger.error(getErrorMessage(e)),new Error(`${REMOVE_ERROR_PREFIX.INVALID_REMOVE}: '${o}'`)}if(-1===e.nextIndex){if(o===r.selector)throw new Error(`${STYLE_ERROR_PREFIX.NO_STYLE_OR_REMOVE}: '${e.cssToParse}'`);e.cssToParse=""}let s,n=[],i=!1;try{o=r.selector,n=r.stylesOfSelector,s=t.getSelectorAst(o),i=!0}catch(e){i=!1}return e.nextIndex>0&&(e.cssToParse=e.cssToParse.slice(e.nextIndex)),{success:i,selector:o,ast:s,stylesOfSelector:n}},parseUntilClosingBracket=(e,t)=>{REGEXP_DECLARATION_DIVIDER.lastIndex=e.nextIndex;let r=REGEXP_DECLARATION_DIVIDER.exec(e.cssToParse);if(null===r)throw new Error(`${STYLE_ERROR_PREFIX.INVALID_STYLE}: '${e.cssToParse}'`);let o=r.index,s=r[0];if(s===BRACKET.CURLY.RIGHT){if(0!==e.cssToParse.slice(e.nextIndex,o).trim().length)throw new Error(`${STYLE_ERROR_PREFIX.INVALID_STYLE}: '${e.cssToParse}'`);if(0===t.length)throw new Error(`${STYLE_ERROR_PREFIX.NO_STYLE}: '${e.cssToParse}'`);return o}if(s===COLON){const n=o;if(REGEXP_DECLARATION_END.lastIndex=n,r=REGEXP_DECLARATION_END.exec(e.cssToParse),null===r)throw new Error(`${STYLE_ERROR_PREFIX.UNCLOSED_STYLE}: '${e.cssToParse}'`);o=r.index,s=r[0];const i=e.cssToParse.slice(e.nextIndex,n).trim();if(0===i.length)throw new Error(`${STYLE_ERROR_PREFIX.NO_PROPERTY}: '${e.cssToParse}'`);const l=e.cssToParse.slice(n+1,o).trim();if(0===l.length)throw new Error(`${STYLE_ERROR_PREFIX.NO_VALUE}: '${e.cssToParse}'`);if(t.push({property:i,value:l}),s===BRACKET.CURLY.RIGHT)return o}return e.cssToParse=e.cssToParse.slice(o+1),e.nextIndex=0,parseUntilClosingBracket(e,t)},parseNextStyle=e=>{const t=[],r=parseUntilClosingBracket(e,t);REGEXP_NON_WHITESPACE.lastIndex=r+1;const o=REGEXP_NON_WHITESPACE.exec(e.cssToParse);if(null===o)return e.cssToParse="",t;const s=o.index;return e.cssToParse=e.cssToParse.slice(s),t},parseStylesheet=(e,t)=>{const r=e.trim();if(r.includes(`${SLASH}${ASTERISK}`)&&r.includes(`${ASTERISK}${SLASH}`))throw new Error(`${STYLE_ERROR_PREFIX.NO_COMMENT} in stylesheet: '${r}'`);const o={isSelector:!0,nextIndex:0,cssToParse:r,selectorBuffer:"",rawRuleData:{selector:""}},s=createRawResultsMap();let n;for(;o.cssToParse;)if(o.isSelector){if(o.nextIndex=o.cssToParse.indexOf(BRACKET.CURLY.LEFT),0===o.selectorBuffer.length&&0===o.nextIndex)throw new Error(`${STYLE_ERROR_PREFIX.NO_SELECTOR}: '${o.cssToParse}'`);-1===o.nextIndex?o.selectorBuffer=o.cssToParse:o.selectorBuffer+=o.cssToParse.slice(0,o.nextIndex),n=parseSelectorPart(o,t),n.success?(o.rawRuleData.selector=n.selector.trim(),o.rawRuleData.ast=n.ast,o.rawRuleData.rawStyles=n.stylesOfSelector,o.isSelector=!1,-1===o.nextIndex?(saveToRawResults(s,o.rawRuleData),restoreRuleAcc(o)):(o.nextIndex=1,o.selectorBuffer="")):(o.selectorBuffer+=BRACKET.CURLY.LEFT,o.cssToParse=o.cssToParse.slice(1))}else{var i;const e=parseNextStyle(o);null===(i=o.rawRuleData.rawStyles)||void 0===i||i.push(...e),saveToRawResults(s,o.rawRuleData),o.nextIndex=0,restoreRuleAcc(o),o.isSelector=!0}return combineRulesData(s)},isNumber=e=>"number"==typeof e&&!Number.isNaN(e),isSupported=void 0!==window.requestAnimationFrame,timeout=isSupported?requestAnimationFrame:window.setTimeout,deleteTimeout=isSupported?cancelAnimationFrame:clearTimeout,perf=isSupported?performance:Date,DEFAULT_THROTTLE_DELAY_MS=150;class ThrottleWrapper{constructor(e,t,r){this.context=e,this.callback=t,this.throttleDelayMs=r||DEFAULT_THROTTLE_DELAY_MS,this.wrappedCb=this.wrappedCallback.bind(this)}wrappedCallback(e){this.lastRunTime=isNumber(e)?e:perf.now(),this.timeoutId&&(deleteTimeout(this.timeoutId),delete this.timeoutId),clearTimeout(this.timerId),delete this.timerId,this.callback&&this.callback(this.context)}hasPendingCallback(){return isNumber(this.timeoutId)||isNumber(this.timerId)}run(){if(!this.hasPendingCallback()){if(void 0!==this.lastRunTime){const e=perf.now()-this.lastRunTime;if(e<this.throttleDelayMs)return void(this.timerId=window.setTimeout(this.wrappedCb,this.throttleDelayMs-e))}this.timeoutId=timeout(this.wrappedCb)}}static now(){return perf.now()}}const LAST_EVENT_TIMEOUT_MS=10,IGNORED_EVENTS=["mouseover","mouseleave","mouseenter","mouseout"],SUPPORTED_EVENTS=["keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel"],SAFARI_PROBLEMATIC_EVENTS=["wheel"];class EventTracker{constructor(){_defineProperty(this,"getLastEventType",(()=>this.lastEventType)),_defineProperty(this,"getTimeSinceLastEvent",(()=>this.lastEventTime?Date.now()-this.lastEventTime:null)),this.trackedEvents=isSafariBrowser?SUPPORTED_EVENTS.filter((e=>!SAFARI_PROBLEMATIC_EVENTS.includes(e))):SUPPORTED_EVENTS,this.trackedEvents.forEach((e=>{document.documentElement.addEventListener(e,this.trackEvent,!0)}))}trackEvent(e){this.lastEventType=e.type,this.lastEventTime=Date.now()}isIgnoredEventType(){const e=this.getLastEventType(),t=this.getTimeSinceLastEvent();return!!e&&IGNORED_EVENTS.includes(e)&&!!t&&t<LAST_EVENT_TIMEOUT_MS}stopTracking(){this.trackedEvents.forEach((e=>{document.documentElement.removeEventListener(e,this.trackEvent,!0)}))}}const isEventListenerSupported=void 0!==window.addEventListener,observeDocument=(e,t)=>{natives.MutationObserver?(e.domMutationObserver=new natives.MutationObserver((r=>{if(!r||0===r.length)return;const o=new EventTracker;o.isIgnoredEventType()&&(e=>e.every((e=>"attributes"===e.type)))(r)||(e.eventTracker=o,t())})),e.domMutationObserver.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class"]})):isEventListenerSupported&&(document.addEventListener("DOMNodeInserted",t,!1),document.addEventListener("DOMNodeRemoved",t,!1),document.addEventListener("DOMAttrModified",t,!1))},disconnectDocument=(e,t)=>{var r;e.domMutationObserver?e.domMutationObserver.disconnect():isEventListenerSupported&&(document.removeEventListener("DOMNodeInserted",t,!1),document.removeEventListener("DOMNodeRemoved",t,!1),document.removeEventListener("DOMAttrModified",t,!1)),null===(r=e.eventTracker)||void 0===r||r.stopTracking()},mainObserve=(e,t)=>{e.isDomObserved||(e.isDomObserved=!0,observeDocument(e,t))},mainDisconnect=(e,t)=>{e.isDomObserved&&(e.isDomObserved=!1,disconnectDocument(e,t))},CONTENT_ATTR_PREFIX_REGEXP=/^("|')adguard.+?/,removeElement=(e,t)=>{const{node:r}=t;t.removed=!0;const o=getElementSelectorPath(r),s=e.removalsStatistic[o]||0;s>MAX_STYLE_PROTECTION_COUNT?logger.error(`ExtendedCss: infinite loop protection for selector: '${o}'`):r.parentElement&&(r.parentElement.removeChild(r),e.removalsStatistic[o]=s+1)},setStyleToElement=(e,t)=>{e instanceof HTMLElement&&Object.keys(t).forEach((r=>{if(void 0!==e.style.getPropertyValue(r.toString())){let o=t[r];if(!o)return;if(r===CONTENT_CSS_PROPERTY&&o.match(CONTENT_ATTR_PREFIX_REGEXP))return;o=removeSuffix(o.trim(),"!important").trim(),e.style.setProperty(r,o,"important")}}))},isIAffectedElement=e=>"node"in e&&"rules"in e&&e.rules instanceof Array,isAffectedElement=e=>"node"in e&&"originalStyle"in e&&"rules"in e&&e.rules instanceof Array,applyStyle=(e,t)=>{if(t.protectionObserver)return;let r;if(e.beforeStyleApplied){if(!isIAffectedElement(t))throw new Error("Returned IAffectedElement should have 'node' and 'rules' properties");if(r=e.beforeStyleApplied(t),!r)throw new Error("Callback 'beforeStyleApplied' should return IAffectedElement")}else r=t;if(!isAffectedElement(r))throw new Error("Returned IAffectedElement should have 'node' and 'rules' properties");const{node:o,rules:s}=r;for(let t=0;t<s.length;t+=1){const n=s[t],i=null==n?void 0:n.selector,l=null==n?void 0:n.style,a=null==n?void 0:n.debug;if(l){if(l[REMOVE_PSEUDO_MARKER]===PSEUDO_PROPERTY_POSITIVE_VALUE)return void removeElement(e,r);setStyleToElement(o,l)}else if(!a)throw new Error(`No style declaration in rule for selector: '${i}'`)}},revertStyle=e=>{e.protectionObserver&&e.protectionObserver.disconnect(),e.node.style.cssText=e.originalStyle};class ExtMutationObserver{constructor(e){this.styleProtectionCount=0,this.observer=new natives.MutationObserver((t=>{t.length&&(this.styleProtectionCount+=1,e(t,this))}))}observe(e,t){this.styleProtectionCount<MAX_STYLE_PROTECTION_COUNT?this.observer.observe(e,t):logger.error("ExtendedCss: infinite loop protection for style")}disconnect(){this.observer.disconnect()}}const PROTECTION_OBSERVER_OPTIONS={attributes:!0,attributeOldValue:!0,attributeFilter:["style"]},createProtectionCallback=e=>(t,r)=>{if(!t[0])return;const{target:o}=t[0];r.disconnect(),e.forEach((e=>{setStyleToElement(o,e)})),r.observe(o,PROTECTION_OBSERVER_OPTIONS)},protectStyleAttribute=(e,t)=>{if(!natives.MutationObserver)return null;const r=[];t.forEach((e=>{const{style:t}=e;t&&r.push(t)}));const o=new ExtMutationObserver(createProtectionCallback(r));return o.observe(e,PROTECTION_OBSERVER_OPTIONS),o},STATS_DECIMAL_DIGITS_COUNT=4;class TimingStats{constructor(){this.appliesTimings=[],this.appliesCount=0,this.timingsSum=0,this.meanTiming=0,this.squaredSum=0,this.standardDeviation=0}push(e){this.appliesTimings.push(e),this.appliesCount+=1,this.timingsSum+=e,this.meanTiming=this.timingsSum/this.appliesCount,this.squaredSum+=e*e,this.standardDeviation=Math.sqrt(this.squaredSum/this.appliesCount-Math.pow(this.meanTiming,2))}}const beautifyTimingNumber=e=>Number(e.toFixed(STATS_DECIMAL_DIGITS_COUNT)),beautifyTimings=e=>({appliesTimings:e.appliesTimings.map((e=>beautifyTimingNumber(e))),appliesCount:beautifyTimingNumber(e.appliesCount),timingsSum:beautifyTimingNumber(e.timingsSum),meanTiming:beautifyTimingNumber(e.meanTiming),standardDeviation:beautifyTimingNumber(e.standardDeviation)}),printTimingInfo=e=>{if(e.areTimingsPrinted)return;e.areTimingsPrinted=!0;const t={};e.parsedRules.forEach((e=>{if(e.timingStats){const{selector:r,style:o,debug:s,matchedElements:n}=e;if(!o&&!s)throw new Error(`Rule should have style declaration for selector: '${r}'`);const i={selectorParsed:r,timings:beautifyTimings(e.timingStats)};o&&o[REMOVE_PSEUDO_MARKER]===PSEUDO_PROPERTY_POSITIVE_VALUE?i.removed=!0:(i.styleApplied=o||null,i.matchedElements=n),t[r]=i}})),0!==Object.keys(t).length&&logger.info("[ExtendedCss] Timings in milliseconds for %o:\n%o",window.location.href,t)},findAffectedElement=(e,t)=>e.find((e=>e.node===t)),applyRule=(e,t)=>{const r=!!t.debug||e.debug;let o;r&&(o=ThrottleWrapper.now());const{ast:s}=t,n=[];try{n.push(...selectElementsByAst(s))}catch(t){e.debug&&logger.error(getErrorMessage(t))}if(n.forEach((r=>{let o=findAffectedElement(e.affectedElements,r);if(o)o.rules.push(t),applyStyle(e,o);else{const s=r.style.cssText;o={node:r,rules:[t],originalStyle:s,protectionObserver:null},applyStyle(e,o),e.affectedElements.push(o)}})),r&&o){const e=ThrottleWrapper.now()-o;t.timingStats||(t.timingStats=new TimingStats),t.timingStats.push(e)}return n},applyRules=e=>{const t=[];mainDisconnect(e,e.mainCallback),e.parsedRules.forEach((r=>{const o=applyRule(e,r);Array.prototype.push.apply(t,o),r.debug&&(r.matchedElements=o)}));let r=e.affectedElements.length;for(;r;){const o=e.affectedElements[r-1];if(!o)break;t.includes(o.node)?o.removed||o.protectionObserver||(o.protectionObserver=protectStyleAttribute(o.node,o.rules)):(revertStyle(o),e.affectedElements.splice(r-1,1)),r-=1}mainObserve(e,e.mainCallback),printTimingInfo(e)},APPLY_RULES_DELAY=150;class ExtendedCss{constructor(e){if(isBrowserSupported()||logger.error("Browser is not supported by ExtendedCss"),!e)throw new Error("ExtendedCss configuration should be provided.");if(this.context={beforeStyleApplied:e.beforeStyleApplied,debug:!1,affectedElements:[],isDomObserved:!1,removalsStatistic:{},parsedRules:[],mainCallback:()=>{}},!e.styleSheet&&!e.cssRules)throw new Error("ExtendedCss configuration should have 'styleSheet' or 'cssRules' defined.");if(e.styleSheet)try{this.context.parsedRules.push(...parseStylesheet(e.styleSheet,extCssDocument))}catch(e){throw new Error(`Pass the rules as configuration.cssRules since configuration.styleSheet cannot be parsed because of: '${getErrorMessage(e)}'`)}if(e.cssRules&&this.context.parsedRules.push(...parseRules(e.cssRules,extCssDocument)),this.context.debug=e.debug||this.context.parsedRules.some((e=>e.debug===DEBUG_PSEUDO_PROPERTY_GLOBAL_VALUE)),this.applyRulesScheduler=new ThrottleWrapper(this.context,applyRules,APPLY_RULES_DELAY),this.context.mainCallback=this.applyRulesScheduler.run.bind(this.applyRulesScheduler),this.context.beforeStyleApplied&&"function"!=typeof this.context.beforeStyleApplied)throw new Error(`Invalid configuration. Type of 'beforeStyleApplied' should be a function, received: '${typeof this.context.beforeStyleApplied}'`);this.applyRulesCallbackListener=()=>{applyRules(this.context)}}init(){nativeTextContent.setGetter()}apply(){applyRules(this.context),"complete"!==document.readyState&&document.addEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}dispose(){mainDisconnect(this.context,this.context.mainCallback),this.context.affectedElements.forEach((e=>{revertStyle(e)})),document.removeEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}getAffectedElements(){return this.context.affectedElements}static query(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"!=typeof e)throw new Error("Selector should be defined as a string.");const r=ThrottleWrapper.now();try{return extCssDocument.querySelectorAll(e)}finally{const e=ThrottleWrapper.now();t||logger.info(`[ExtendedCss] Elapsed: ${Math.round(1e3*(e-r))} μs.`)}}static validate(e){try{const{selector:t}=parseRemoveSelector(e);return ExtendedCss.query(t),{ok:!0,error:null}}catch(t){return{ok:!1,error:`Error: Invalid selector: '${e}' -- ${getErrorMessage(t)}`}}}}var cssHitsCounter=null,getCssHitsCounter=function(e){return e?(cssHitsCounter||(cssHitsCounter=new CssHitsCounter((function(e){logDebug(JSON.stringify(e))}))),cssHitsCounter):null};function returnFalse(){return!1}var disabledDescriptor={get:returnFalse,set:returnFalse},applyCssText=function(e,t){if(e){var r=document.createElement("style");r.setAttribute(TYPE_ATTR_NAME,TYPE_ATTR_VALUE),t&&r.setAttribute(NONCE_ATTR_NAME,t);var o=document.createTextNode(e);r.appendChild(o);var s=currentScript;currentScript.parentNode!=rootElement&&(s=null),rootElement.insertBefore(r,s),Object.defineProperty(r,"disabled",disabledDescriptor),Object.defineProperty(r.sheet,"disabled",disabledDescriptor),protectStyleElement(r,o,t)}},applyCss=function(e,t){if(getCssHitsCounter(configuration.verbose),e instanceof Array)for(var r=e.length;r--;)applyCssText(e[r],t);else applyCssText(e,t)},applyExtendedCss=function(e){if(e){var t={cssRules:e},r=getCssHitsCounter(configuration.verbose);r&&(t.beforeStyleApplied=r.countAffectedByExtendedCss.bind(r)),new ExtendedCss(t).apply()}},applyScript=function applyScript(scriptText){if(scriptText)try{eval(AGPolicy.createScript(scriptText))}catch(e){logError(e)}},isNonRawUserscriptLink=function(e){return[/github\.com\/[^/]+\/[^/]+\/blob\//,/bitbucket\.org\/[^/]+\/[^/]+\/src\//,/gitlab\.com\/.+\/-\/blob\//].some((function(t){return t.test(e)}))};function getClosestAnchor(e){if(e instanceof Node){for(var t=e;t&&!(t instanceof HTMLAnchorElement);)t=t.parentNode;return t}}function detectSubscriptionIfNeeded(e,t){try{if(!e)return;if("http:"===t.protocol||"https:"===t.protocol){if("subscribe.adblockplus.org"!==t.host||"/"!==t.pathname)return}else if(!t.href||-1===t.href.indexOf("abp:subscribe"))return;return t.search?"adguard:subscribe"+t.search:t.href.replace("abp:subscribe","adguard:subscribe")}catch(e){logError(e)}}function detectUserscriptIfNeeded(e,t){try{if(!e)return;if("http:"!==t.protocol&&"https:"!==t.protocol||-1===t.pathname.indexOf(".user.js")||!t.pathname.endsWith(".user.js")||isNonRawUserscriptLink(t.href))return;var r=t.href;return t.search&&(r=r.replace(t.search,"")),"adguard:userscript?location="+r}catch(e){logError(e)}}function onClick(e,t){try{if(2===t.button)return;var r=getClosestAnchor(t.target);if(!r)return;var o=detectSubscriptionIfNeeded(e.isSubscriptionIntercept,r);if(o)return void(r.href=o);var s=detectUserscriptIfNeeded(e.isUserscriptIntercept,r);if(s)return void(r.href=s)}catch(e){logError(e)}}var interceptRequests=function(e){document.documentMode<10||document.addEventListener("click",(function(t){onClick(e,t)}))},checkSafeBrowsing=function(e){if(e){-1!=e.indexOf("?")?e+="&":e+="?",e+="u=",e+=encodeURIComponent(window.location.href),e+="&r=",e+=Math.random();var t=document.createElement("script");t.setAttribute("defer",""),t.setAttribute("src",AGPolicy.createScriptURL(e)),t.setAttribute("type","text/javascript"),t.onload=t.onerror=function(){t.parentNode&&t.parentNode.removeChild(t)},rootElement.appendChild(t)}},isApplyCommonCss=!0,isApplyCss=!0,isApplyScript=!0,CSS_EXCEPTIONS=["mail.yahoo.com","map.baidu.com","ditu.baidu.com"],SAFEBROWSING_EXCEPTIONS=["muve.pl","app.print.avery.com"],isCssException=-1!==CSS_EXCEPTIONS.indexOf(document.location.hostname),isSafeBrowsingException=-1!==SAFEBROWSING_EXCEPTIONS.indexOf(document.location.hostname);if(window!==window.top){var width=Math.max(document.documentElement.clientWidth,window.innerWidth||0),height=Math.max(document.documentElement.clientHeight,window.innerHeight||0);isApplyCommonCss=height*width>1e5,configuration.filteringContext&&Object.prototype.hasOwnProperty.call(configuration.filteringContext,"isReferrerRuleElemhide")&&Object.prototype.hasOwnProperty.call(configuration.filteringContext,"isReferrerRuleJsInject")&&(isApplyCss=configuration.filteringContext.isReferrerRuleElemhide,isApplyScript=configuration.filteringContext.isReferrerRuleJsInject)}var contentScriptExecutionFlagToCheck=configuration.nonce||"adgRunId",runContentScript=function(){document[contentScriptExecutionFlagToCheck]||(document[contentScriptExecutionFlagToCheck]=!0,isApplyCss&&(isCssException||(isApplyCommonCss&&configuration.commonCss&&applyCss(configuration.commonCss,configuration.nonce),applyCss(configuration.specificCss,configuration.nonce)),applyExtendedCss(configuration.extendedCssRules)),isApplyScript&&applyScript(configuration.script),(configuration.interceptionContext.isSubscriptionIntercept||configuration.interceptionContext.isUserscriptIntercept)&&interceptRequests(configuration.interceptionContext),isSafeBrowsingException||checkSafeBrowsing(configuration.safeBrowsingUrl))},cleanUp=function(){delete configuration.commonCss,delete configuration.specificCss,delete configuration.extendedCssRules,delete configuration.script,delete configuration.filteringContext,delete configuration.safeBrowsingUrl,rootElement.removeChild(currentScript)},init=function(){runContentScript(),cleanUp()};init()})();

